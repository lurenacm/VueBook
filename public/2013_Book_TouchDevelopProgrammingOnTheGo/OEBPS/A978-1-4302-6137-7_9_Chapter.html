<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><title>Game Board</title><link href="springer_epub.css" type="text/css" rel="styleSheet"/></head><body><div class="ChapterContextInformation"><div class="ContextInformation" id="Chap9"><span class="ContextInformationAuthorEditorNames"><span class="Author"><span class="AuthorName">R. Nigel Horspool</span> and </span><span class="Author"><span class="AuthorName">Nikolai Tillmann</span></span></span><span class="ContextInformationBookTitles"><span class="BookTitle" xml:lang="en">TouchDevelop: Programming on the Go</span><span class="BookEdition">Third Edition</span></span><span class="ChapterDOI">10.1007/978-1-4302-6137-7_9</span><span class="ChapterCopyright">© R. Nigel Horspool 2013</span></div></div><!--Begin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" xml:lang="en">9. Game Board</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">R. Nigel Horspool</span><sup>1 <span class="ContactIcon"/></sup> and </span><span class="Author"><span class="AuthorName">Nikolai Tillmann</span><sup>2 <span class="ContactIcon"/></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff1"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Canada, USA</div></div><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(2)</span><div class="AffiliationText">TU Berlin, Germany</div></div><div class="ClearBoth"> </div></div></div><div class="ArticleOrChapterToc"><div class="TocLine"><a href="#Sec1">9.1 Introduction</a></div><div class="TocLine"><a href="#Sec5">9.2 The Board datatype</a></div><div class="TocLine"><a href="#Sec11">9.3 The Sprite datatype</a></div><div class="TocLine"><a href="#Sec16">9.4 The Sprite Collection datatype</a></div><div class="TocLine"><a href="#Sec17">9.5 Touching and board events</a></div><div class="TocLine"><a href="#Sec26">9.6 Debugging games</a></div></div><div class="Abstract" id="Abs1" xml:lang="en"><div class="Heading">Abstract</div><div class="Para">TouchDevelop includes a “game board” API for writing simple sprite-based games. The API includes a primitive physics engine to simplify common game loops where objects are moving while they experience gravity and friction. Game board elements can be orchestrated using events based on touch and regular timing intervals.</div></div><!--End Abstract--><div class="Fulltext"><div class="Para">TouchDevelop includes a “game board” API for writing simple sprite-based games. The API includes a primitive physics engine to simplify common game loops where objects are moving while they experience gravity and friction. Game board elements can be orchestrated using events based on touch and regular timing intervals.</div><div id="Sec1" class="Section1 RenderAsSection1"><h2 class="Heading">9.1 Introduction</h2><div id="Sec2" class="Section2 RenderAsSection2"><h3 class="Heading">9.1.1 What is a sprite?</h3><div class="Para">In TouchDevelop, sprites are 2D bitmaps that are drawn directly to the screen. Sprites are commonly used to display information such as health bars, number of lives, or text such as scores. Some games, especially older games, are composed entirely of sprites. TouchDevelop allows creation and use of several types of sprite, such as ellipse, rectangle, text and picture. More details about a sprite’s capabilities can be obtained from <span class="ExternalRef"><a href="http://msdn.microsoft.com/en-us/library/bb203919.aspx"><span class="RefSource">http:​/​/​msdn.​microsoft.​com/​en-us/​library/​bb203919.​aspx</span></a></span>
            </div></div><div id="Sec3" class="Section2 RenderAsSection2"><h3 class="Heading">9.1.2 Coordinates and units</h3><div class="Para">Positions in the game board API are based on pixels. The origin of the grid is the top left corner when holding the device upright, the x-axis is horizontal, the y-axis vertical. Sprite positions refer to the center of the sprite, i.e., the halfway point of its width and height before any rotation is applied. The reasoning behind this choice is so that sprites can rotate around their center. Future versions of TouchDevelop may provide more control for offsetting sprites from their position. Speed and acceleration are measured in pixels/second and pixels/second<sup>2</sup>.</div></div><div id="Sec4" class="Section2 RenderAsSection2"><h3 class="Heading">9.1.3 Game program structure</h3><div class="Para">The code for a typical game has an underlying structure like the following.</div><div class="Para ParaTypeProgramcode">           <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">action</span></span>
              <span class="EmphasisFontCategoryNonProportional">main( )</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">◳board := media</span> → <span class="EmphasisFontCategoryNonProportional">create board(640)</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">// … create sprites, add color and features to the board</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">◳board</span> → <span class="EmphasisFontCategoryNonProportional">post to wall</span>
            </div><div class="Para ParaTypeProgramcode">           <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">event</span></span>
              <span class="EmphasisFontCategoryNonProportional">gameloop( )</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">// … move objects around …</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">◳board</span> → <span class="EmphasisFontCategoryNonProportional">update on wall</span>
            </div><div class="Para">The <span class="EmphasisFontCategoryNonProportional">gameloop</span> event is triggered approximately every 50 milliseconds, i.e. about 20 times per second.</div></div></div><div id="Sec5" class="Section1 RenderAsSection1"><h2 class="Heading">9.2 The Board datatype</h2><div class="Para">The media resource three two methods for creating a game board; they are listed in Table <span class="InternalRef"><a href="#Tab1">9-1</a></span>. The maximum height supported by TouchDevelop for a board is 640 pixels. A board created by <span class="EmphasisFontCategoryNonProportional">media</span>→<span class="EmphasisFontCategoryNonProportional">create board</span> is 456 pixels wide; a board created by <span class="EmphasisFontCategoryNonProportional">media</span>→<span class="EmphasisFontCategoryNonProportional">create portrait board</span> is 480 pixels wide. A board remains invisible until it is posted to the wall.</div><div class="Para">Once posted, updates to the board state and the sprites on the board become visible only when calling <span class="EmphasisFontCategoryNonProportional">board</span>→<span class="EmphasisFontCategoryNonProportional">update on wall</span>.</div><div class="Para">The methods of the <span class="EmphasisFontCategoryNonProportional">Board</span> datatype concerned with the board’s dimensions and general appearance are listed in Table <span class="InternalRef"><a href="#Tab2">9-2</a></span>. The board has a background color and a background picture that can be set separately. The default background color is transparent, and no background picture is provided by default. An additional possibility is to copy the images captured by the device’s primary camera and use those images as an ever changing background for the board. Only one of these background possibilities can be active at a time.
<div id="Tab1" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 9-1</span><div class="SimplePara">Methods to create a board</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Methods</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">media→create board(</span>
                      </div><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">height : Number) : Board</span>
                      </div></td><td align="left"><div class="SimplePara">Creates a new board with the specified height in pixels</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">media→create portrait board : Board</span>
                      </div></td><td align="left"><div class="SimplePara">Creates a new board that fills the entire screen when displayed and assumes the device is held in portrait mode.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">media→create landscape board : Board</span>
                      </div></td><td align="left"><div class="SimplePara">Creates a new board that fills the entire screen when displayed and assumes the device is held in landscape mode.</div></td></tr></tbody></table></div>
          </div><div id="Sec6" class="Section2 RenderAsSection2"><h3 class="Heading">9.2.1 Creating sprites</h3><div class="Para">There are four kinds of sprite that display different kinds of visual content. They can have the shapes of ellipses or rectangles. They can be drawn as solid figures, or they can take the form of a piece of updatable text, or be created from a picture. There is a fifth kind of sprite known as an <span class="EmphasisTypeItalic">anchor sprite</span>. It is invisible and has a special purpose, which is explained below under the heading ‘springs and anchors’. Sprites are associated with particular game boards and are created by methods of the <span class="EmphasisFontCategoryNonProportional">Board</span> type. The methods for creating and accessing sprites are listed in Table <span class="InternalRef"><a href="#Tab3">9-3</a></span>.</div><div class="Para">Sprites have initial positions centered on the board and no speed or angular rotation. These properties can be set for each sprite using the methods of the <span class="EmphasisFontCategoryNonProportional">Sprite</span> datatype.</div><div class="Para">In addition to the <span class="EmphasisFontCategoryNonProportional">at</span> method, a <span class="EmphasisTypeBold">for each</span> loop can be used to access all the sprites on a board. If <span class="EmphasisFontCategoryNonProportional">board</span> is a variable of type <span class="EmphasisFontCategoryNonProportional">Board</span>, then the loop has the following structure.</div><div class="Para ParaTypeProgramcode">    <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">for each</span></span>
              <span class="EmphasisFontCategoryNonProportional">sprite</span>
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">in</span></span>
              <span class="EmphasisFontCategoryNonProportional">board</span>
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">where</span></span>
              <span class="EmphasisFontCategoryNonProportional">true</span>
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">do</span></span>
            </div><div class="Para ParaTypeProgramcode">           <span class="EmphasisFontCategoryNonProportional">// access the sprite</span>
            </div><div class="Para">
              <div id="Tab2" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 9-2</span><div class="SimplePara">Methods of Board datatype: appearance</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Board Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">clear background camera : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Removes any association of the board’s background image with the camera</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">clear background picture : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Removes any background picture provided for the board</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">height : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the board height in pixels</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">is landscape board : Boolean</span>
                        </div></td><td align="left"><div class="SimplePara">Returns true if the board is designed for viewing in landscape mode</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set background(color : Color) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the background color for the board</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set background camera(camera : Camera) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the background for the board to be image captured by the primary camera</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set background picture(</span>
                        </div><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">picture : Picture) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets a background picture to display on the board</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">width : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the board width in pixels</div></td></tr></tbody></table></div>
              <div id="Tab3" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 9-3</span><div class="SimplePara">Methods of Board datatype: creating / accessing sprites</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Board Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">at(i : Number) : Sprite</span>
                        </div></td><td align="left"><div class="SimplePara">Returns sprite number i on this board instance (0 ≤ i &lt; count)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">count : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the number of sprites on this board</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">create anchor(width : Number, height : Number) : Sprite</span>
                        </div></td><td align="left"><div class="SimplePara">Creates an invisible unmovable anchor sprite</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">create ellipse(width : Number, height : Number) : Sprite</span>
                        </div></td><td align="left"><div class="SimplePara">Creates a sprite with an elliptical shape</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">create picture(picture : Picture) : Sprite</span>
                        </div></td><td align="left"><div class="SimplePara">Creates a sprite with the same dimensions and image as the picture</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">create rectangle(width : Number, height : Number) : Sprite</span>
                        </div></td><td align="left"><div class="SimplePara">Creates a sprite with a rectangular shape</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">create sprite set : Sprite Set</span>
                        </div></td><td align="left"><div class="SimplePara">Creates an empty collection of sprites</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">create text(width : Number,</span>
                        </div><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">height : Number, fontSize : Number, text : String) : Sprite</span>
                        </div></td><td align="left"><div class="SimplePara">Creates a sprite which is displayed on the board as a text string</div></td></tr></tbody></table></div>
            </div><div class="Para">During games it is very useful to have several collections of sprites. For example, one collection contains spacecraft, another asteroids, and so on.</div><div class="Para">A sprite collection can be created as an instance of the <span class="EmphasisFontCategoryNonProportional">Sprite Set</span> datatype. The method <span class="EmphasisFontCategoryNonProportional">create sprite set</span> creates a new set which can hold sprites associated with the <span class="EmphasisFontCategoryNonProportional">Board</span> instance. Sprites can be added to and removed from these sets by using methods of the <span class="EmphasisFontCategoryNonProportional">Sprite Set</span> datatype.</div></div><div id="Sec7" class="Section2 RenderAsSection2"><h3 class="Heading">9.2.2 Obstacles and boundaries</h3><div class="Para">Obstacles are walls that can be added to the board. Walls cannot be moved once created. Moving sprites which encounter an obstacle will bounce back with a speed determined by the product of the obstacle’s <span class="EmphasisTypeItalic">elasticity</span> and the sprite’s elasticity. Elasticities of 1 for both the obstacle and the sprite means the sprite will maintain its full speed, albeit in a different direction. If one or both elasticities are 0, there will be full absorption of the impulse; the sprite will stick to the wall. By default, all elasticities are 1.</div><div class="Para">By default, the board is open, meaning it has no boundary. Sprites moving off the visual part of the board will simply continue moving away. Since it is common to need reflecting walls around the board, the <span class="EmphasisFontCategoryNonProportional">create boundary(distance)</span> method can be used to create a reflective set of walls around the board at the given distance from the board’s edges. The elasticity of these reflective walls is 1, i.e. the sprite’s speed is not reduced. If the distance of the boundary from the board’s edge is larger than the sprite’s size, a sprite can disappear off the screen before bouncing back and re-appearing. If the distance is set as a negative number, the boundaries are located inside the board area.</div><div class="Para">The methods for creating obstacles and boundaries are listed in Table <span class="InternalRef"><a href="#Tab4">9-4</a></span>.</div></div><div id="Sec8" class="Section2 RenderAsSection2"><h3 class="Heading">9.2.3 Forces and animation</h3><div id="Sec9" class="Section3 RenderAsSection3"><h4 class="Heading">Gravity and friction</h4><div class="Para">A uniform force can be applied to all sprites on the board. For instance, there could be a force which pulls all objects towards the bottom of the screen, mimicking the force of <span class="EmphasisTypeItalic">gravity</span>. However this gravitational force need not remain constant. If the device possesses the necessary sensors, the script can repeatedly use the device’s orientation, as determined by its gyroscope, or its accelerometer readings to vary the force and direction of gravity that is experienced by objects in the game.
<div id="Tab4" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 9-4</span><div class="SimplePara">Methods of Board datatype: obstacles / boundaries</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Board Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">create boundary(distance : Number) : Nothing</span>
                          </div></td><td align="left"><div class="SimplePara">Create perfectly reflective walls around the board at the given distance from its edges</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">create obstacle(x : Number,</span>
                          </div><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">y : Number, xsegment : Number, ysegment : Number,</span>
                          </div><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">elasticity : Number) : Nothing</span>
                          </div></td><td align="left"><div class="SimplePara">Create a solid obstacle in the form of a line starting at x, y and continuing xsegment, ysegment in the x and y directions; elasticity is in the range 0 (sticky) to 1 (fully reflective)</div></td></tr></tbody></table></div>
              </div><div class="Para">Once sprites are given speeds or if gravity has been made non-zero, the board engine can update a sprite's position. To update all sprite positions for one time step, the <span class="EmphasisFontCategoryNonProportional">board</span>→<span class="EmphasisFontCategoryNonProportional">evolve</span> method should be invoked. The duration of the time step is simply the time since the last call to <span class="EmphasisFontCategoryNonProportional">board</span>→<span class="EmphasisFontCategoryNonProportional">evolve</span> or since the creation of the board.</div><div class="Para">A simple script which uses obstacles and gravity appears in Figure <span class="InternalRef"><a href="#Fig1">9-1</a></span>.
<div class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img src="A978-1-4302-6137-7_9_Fig1_HTML.jpg" alt="A978-1-4302-6137-7_9_Fig1_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 9-1</span><div class="SimplePara">Example script: a moving ball (/nyuc)</div></div></div></div>
              </div><div class="Para">The script creates a board and adds a reflective wall around the entire board. It then creates a small obstacle wall and a single sprite in the shape of a ball. Within the game loop, the accelerometer is used to set the gravity on the game board. To make the ball move more quickly, the acceleration is scaled by a factor of 1000.</div><div class="Para">By default, a sprite keeps on moving without slowing down. It can lose speed only if it moves in an opposite direction to gravity or if it loses energy in a collision with an obstacle whose elasticity is less than 1. If it is desirable to make sprites slow down by themselves, a default <span class="EmphasisTypeItalic">friction</span> setting can be provided for the board or for each sprite individually.</div><div class="Para">Each sprite can have its own friction setting but, if not set, each sprite experiences the default friction from the board. A friction is defined as the fraction of the forward speed that is experienced as a backwards force. A friction of 0 corresponds to no friction, and a friction of 1 means the sprite will not move at all.</div><div class="Para">The methods for animating the board and applying forces to sprites are summarized in Table <span class="InternalRef"><a href="#Tab5">9-5</a></span>.
<div id="Tab5" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 9-5</span><div class="SimplePara">Methods of Board datatype: forces / animation</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Board Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">create spring(sprite1 : Sprite, sprite2 : Sprite, stiffness : Number) : Nothing</span>
                          </div></td><td align="left"><div class="SimplePara">Creates an attractive force between two sprites; stiffness determines the strength of the force</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">evolve : Nothing</span>
                          </div></td><td align="left"><div class="SimplePara">Update the positions of all sprites on the board</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">set friction(friction : Number) : Nothing</span>
                          </div></td><td align="left"><div class="SimplePara">Set the default friction for all sprites which do not have their own friction settings; friction is in the range 0 (no loss of speed) to 1 (total loss of speed)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">set gravity(x : Number, y : Number) : Nothing</span>
                          </div></td><td align="left"><div class="SimplePara">Sets a uniform acceleration vector x,y for all sprites on the board</div></td></tr></tbody></table></div>
              </div></div><div id="Sec10" class="Section3 RenderAsSection3"><h4 class="Heading">Springs and anchors</h4><div class="Para">A spring can be added between two sprites to make them accelerate towards each other. A spring is created by the <span class="EmphasisFontCategoryNonProportional">create spring</span> method listed in Table <span class="InternalRef"><a href="#Tab5">9-5</a></span>. The force of the spring is proportional to the distance between the two sprites. The further they are apart, the stronger the force. The constant of proportionality is determined by the stiffness parameter of <span class="EmphasisFontCategoryNonProportional">create spring</span>. The larger its value, the stronger the attractive force.</div><div class="Para">Without friction to dissipate energy over time, sprites linked by a spring will oscillate indefinitely. With friction, they will eventually converge on the same point. A common scenario is to fix one of the two spring-linked sprites on the board (make it unmovable).</div><div class="Para">One way to produce an unmovable sprite is to set its friction to 1. An alternative possibility is to use an invisible <span class="EmphasisTypeItalic">anchor sprite</span>. The <span class="EmphasisFontCategoryNonProportional">create anchor</span> method creates the invisible sprite with its friction set to 1.0. A sprite linked to an anchor via a spring therefore oscillates around the anchor. Giving the sprite an initial velocity vector perpendicular to the direction of the spring causes the sprite to circle around the anchor. With multiple anchors and springs, some interesting oscillation paths can be produced.</div></div></div></div><div id="Sec11" class="Section1 RenderAsSection1"><h2 class="Heading">9.3 The Sprite datatype</h2><div class="Para">Sprites are movable objects which visually represent parts of a game, such as space ships and asteroids. New sprites are created with methods of the <span class="EmphasisFontCategoryNonProportional">Board</span> datatype. Once a sprite has been created, its position, speed, mass, color, <span class="EmphasisTypeItalic">etc</span>., can be set with methods of the <span class="EmphasisFontCategoryNonProportional">Sprite</span> datatype.</div><div id="Sec12" class="Section2 RenderAsSection2"><h3 class="Heading">Visual attributes</h3><div class="Para">Visual attributes of a sprite such as its color and size are accessed through the methods listed in Table <span class="InternalRef"><a href="#Tab6">9-6</a></span>.
<div id="Tab6" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 9-6</span><div class="SimplePara">Methods of Sprite datatype: visual attributes</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Board Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">color : Color</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the sprite’s color</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">height : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the sprite’s height in pixels</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">hide : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Hide the sprite (make it invisible)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">is visible : Boolean</span>
                        </div></td><td align="left"><div class="SimplePara">Returns true if the sprite is not hidden</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">move clip(x : Number, y : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Adjusts the clipping region around a sprite created from a picture</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">opacity : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the sprite’s opacity; 0 is transparent, 1 is opaque</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">picture : Picture</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the picture for a picture sprite</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set clip(left : Number, top : Number, width : Number, height : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets a clipping region for a sprite created from a picture (an image sprite)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set color(color : Color) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the sprite’s color (ignored if it is a picture sprite)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set height(height : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the sprite’s height, measured in pixels</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set opacity(opacity : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the sprite’s opacity; 0 is transparent, 1 is opaque</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set picture(pic : Picture) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Replaces the picture for sprite created from a picture (ignored for non-picture sprites)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set text(text : String) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Replaces the text for a sprite created from a text string (ignored for non-text sprites)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set width(width : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the sprite’s width, measured in pixels</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set z index(zindex : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the z-index of the sprite</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">show : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Show the sprite (the opposite of hide)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">text : String</span>
                        </div></td><td align="left"><div class="SimplePara">Gets the text from a text sprite</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">width : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Gets the sprite’s width, measured in pixels</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">z index : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Gets the z-index of the sprite</div></td></tr></tbody></table></div>
            </div><div class="Para">The z-index, accessed by the methods <span class="EmphasisFontCategoryNonProportional">set z index</span> and <span class="EmphasisFontCategoryNonProportional">z index</span>, provide control over the order in which sprites are rendered on the screen. If two sprites overlap, the sprite which is rendered second will appear to be on top of the first sprite.</div><div class="Para">The rendering order can be controlled by the z-index values. When these values are provided, the sprites are rendered in order of their z-indexes, from smallest to largest.</div></div><div id="Sec13" class="Section2 RenderAsSection2"><h3 class="Heading">Position and motion</h3><div class="Para">A sprite has a current position and a current angular orientation. Both of these change at rates determined by the sprite’s speed and its angular velocity. These attributes of a sprite are accessed or changed by using the methods listed in Table <span class="InternalRef"><a href="#Tab8">9-8</a></span>.</div></div><div id="Sec14" class="Section2 RenderAsSection2"><h3 class="Heading">Accelerations, forces and bounces</h3><div class="Para">In the absence of gravity, springs and friction, a sprite will keep moving across the board at a constant velocity until it hits a barrier of some kind. However, in the presence of these effects, the sprite’s velocity does change.</div><div class="Para">Springs are created using the <span class="EmphasisFontCategoryNonProportional">create spring</span> method of the board. They have been covered already. The acceleration induced on a sprite by a spring’s force is inversely proportional to the sprite’s mass.
<div id="Tab7" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 9-7</span><div class="SimplePara">Methods of Sprite datatype: position / velocity</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Board Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">angle : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Gets the sprite’s angle in degrees</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">angular speed : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Gets the angular velocity in degrees/sec</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">move(deltax : Number, deltay : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Adjusts the sprite’s position by deltax and deltay in the x,y dimensions</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">move towards(other : Sprite, fraction : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Moves this sprite towards other sprite by specified fraction of the distance</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set angle(angle: Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the angle of the sprite in degrees</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set angular speed(speed : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets angular velocity in degrees/sec</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set pos(x : Number, y : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the position of the sprite to new x and y coordinates</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set speed(vx : Number,</span>
                        </div><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">vy : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the x and y speed components of the sprite, vx and vy are in pixels/sec</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set speed x(vx : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets just the x component of the speed, in pixels/sec</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set speed y(vy : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets just the y component of the speed, in pixels/sec</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set x(x : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the x coordinate of the sprite</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set y(y : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the y coordinate of the sprite</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">speed towards(other : Sprite, magnitude : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the speed of this sprite to move towards another sprite; the speed is in pixels/sec</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">speed x : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Gets the x component of the sprite’s speed in pixels/sec</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">speed y : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Gets the y component of the sprite’s speed in pixels/sec</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">x : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Gets the x coordinate of the position</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">y : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Gets the y coordinate of the position</div></td></tr></tbody></table></div>
            </div><div class="Para">The heavier the sprite, the longer it will take for a spring to have its full effect. Each sprite has a default mass which is simply the product of the sprite’s width and height. However, that default can be overridden by the sprite’s set mass method. A mass cannot be made zero or negative.</div><div class="Para">A gravitational force can be specified for the board and this applies a force to every sprite, excluding any anchor sprites. The size of the force is proportional to the sprite’s mass. However, the effect of the force on a sprite’s speed is inversely proportional to the mass, so the acceleration induced by gravity is independent of the sprite’s mass.</div><div class="Para">An additional force which works to slow down a moving sprite is <span class="EmphasisTypeItalic">friction</span>. A friction value can be specified for the board using its <span class="EmphasisFontCategoryNonProportional">set friction</span> method. This becomes the default friction value for all sprites on the board. However, friction can also be set for individual sprites using the <span class="EmphasisFontCategoryNonProportional">set friction</span> method of the <span class="EmphasisFontCategoryNonProportional">Sprite</span> instance.</div><div class="Para">All these forces listed above combine to produce the net force on a sprite and cause a sprite to move. If the combined forces do not produce the desired effect, there is one more adjustment which can be made. This adjustment is produced by the set acceleration method, covered in the next subsection of this chapter.</div><div class="Para">When a sprite hits an obstacle, the sprite rebounds with a new velocity in a new direction. The magnitude of that new velocity is determined by the product of the elasticities of the sprite and the obstacle. If both elasticities are 1, it is a perfect bounce which loses no energy. The sprite loses no speed. If the product is 0, the sprite stops and stays stuck to the obstacle.</div><div class="Para">The current implementation of the game board does not detect collisions between sprites. It requires too much computation, especially if there are many sprites. One sprite will simply appear to pass through another sprite.</div><div class="Para">The methods for accessing friction, mass and elasticity settings for a sprite are listed in Table <span class="InternalRef"><a href="#Tab8">9-8</a></span>.</div></div><div id="Sec15" class="Section2 RenderAsSection2"><h3 class="Heading">9.3.1 Managing sprites</h3><div class="Para">Implementing a game will usually require some extra programming which is not provided by the features of boards and sprites covered so far. If for example, the game requires forces of a different nature than those provided by springs and gravity, or if collisions between sprites need to be handled, then the additional Sprite methods listed in Table <span class="InternalRef"><a href="#Tab9">9-9</a></span> should be useful.
<div id="Tab8" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 9-8</span><div class="SimplePara">Methods of Sprite datatype: mass, friction, elasticity</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Board Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">elasticity : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Get the sprite’s elasticity as a fraction of speed preservation per bounce (0 to 1)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">friction : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Get the sprite’s friction measured as a fraction of speed loss (0 to 1)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">mass : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Get the sprite’s mass</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set elasticity(elasticity : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Set the sprite’s elasticity as a fraction of speed preservation per bounce (0 to 1)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set friction(friction : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Set the sprite’s friction measured as a fraction of speed loss (0 to 1)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set mass(mass : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Set the sprite’s mass (a value greater than zero)</div></td></tr></tbody></table></div>
              <div id="Tab9" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 9-9</span><div class="SimplePara">Methods of Sprite datatype: additional features</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Sprite Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">acceleration x : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Get the x component of the sprite’s current acceleration in pixels/sec2</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">acceleration y : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Get the y component of the sprite’s current acceleration in pixels/sec2</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">delete : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Delete the sprite</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">equals(other : Sprite) : Boolean</span>
                        </div></td><td align="left"><div class="SimplePara">Returns true if this sprite is the same sprite as the other one</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">location : Location</span>
                        </div></td><td align="left"><div class="SimplePara">Gets the sprite’s geo location (as assigned by the set location method)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">overlap with(sprites : Sprite Set) : Sprite Set</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the subset of sprites which overlap with this sprite</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">overlaps with(other : Sprite) : Boolean</span>
                        </div></td><td align="left"><div class="SimplePara">Returns true if the two sprites overlap</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set acceleration(vx : Number,</span>
                        </div><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">vy : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Set the sprite’s acceleration in pixels/sec2</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set acceleration x(vx : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Set the x component of the sprite’s acceleration in pixels/sec2</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set acceleration y(vy : Number) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Set the x component of the sprite’s acceleration in pixels/sec2</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">set location(location : Location) : Nothing</span>
                        </div></td><td align="left"><div class="SimplePara">Sets the sprite’s geo location</div></td></tr></tbody></table></div>
            </div><div class="Para">For collision detection, the <span class="EmphasisFontCategoryNonProportional">overlap with</span> and <span class="EmphasisFontCategoryNonProportional">overlaps with</span> methods should help. Provided that the sprites are not moving so fast or the sprites are not so small that one sprite completely passes through another sprite during one time step, the colliding sprites will overlap when drawn on the board. The two methods allow the collision to be detected, and then the directions of motion of the two sprites can be overridden to simulate the two sprites bouncing off each other.</div><div class="Para">If, for example, the sprites represent planets revolving around a star, a spring force between a planet and the star is a long way from being a proper implementation of gravitational attraction. In this situation, a good approach would be to avoid using springs altogether and to calculate the force induced on a planet by gravitational attraction. Combining that force with the planet’s current velocity and its mass allows the acceleration induced by gravitational attraction to be calculated. And that acceleration can be explicitly given to the planet by the <span class="EmphasisFontCategoryNonProportional">set acceleration</span> method. When an acceleration is specified, the effect of the acceleration is in addition to any accelerations induced by springs and gravity. The acceleration value remains in effect until changed by a new call to set acceleration.</div><div class="Para">Another possibility is that a sprite needs to be destroyed and removed from the board. In this case, the <span class="EmphasisFontCategoryNonProportional">delete</span> method should be invoked. The sprite instance is automatically removed from the board and from all sprite collections. Any references to the instance become invalid.</div></div></div><div id="Sec16" class="Section1 RenderAsSection1"><h2 class="Heading">9.4 The Sprite Collection datatype</h2><div class="Para">When writing simple games with multiple objects of the same kind (e.g. multiple shots, missiles, <span class="EmphasisTypeItalic">etc</span>.), it quickly becomes necessary to group related sprites into collections. The <span class="EmphasisFontCategoryNonProportional">Board</span> datatype provides the method <span class="EmphasisFontCategoryNonProportional">board</span>→<span class="EmphasisFontCategoryNonProportional">create sprite set</span> which creates a new empty collection of sprites.</div><div class="Para">
            <span class="EmphasisFontCategoryNonProportional">Sprite Set</span> provides most of the methods common to the mutable collection types. These are the methods <span class="EmphasisFontCategoryNonProportional">add</span>, <span class="EmphasisFontCategoryNonProportional">add many</span>, <span class="EmphasisFontCategoryNonProportional">at</span>, <span class="EmphasisFontCategoryNonProportional">count</span>, <span class="EmphasisFontCategoryNonProportional">is invalid</span>, and <span class="EmphasisFontCategoryNonProportional">post to wall</span>. They were covered in <span class="ExternalRef"><a href="A978-1-4302-6137-7_2_Chapter.html"><span class="RefSource">Chapter 2</span></a></span>. However, there is a major difference. All the other collection types are lists of values. It implies that the same value can appear in the list several times. A <span class="EmphasisFontCategoryNonProportional">Sprite Set</span> is, in contrast, an <span class="EmphasisTypeItalic">ordered set</span>. A value can appear at most once in the set. The elements of the set are ordered by their index positions.</div><div class="Para">In addition to the standard methods listed above, the <span class="EmphasisFontCategoryNonProportional">Sprite Set</span> datatype has the special methods listed in Table <span class="InternalRef"><a href="#Tab10">9-10</a></span>. Note that the <span class="EmphasisFontCategoryNonProportional">add</span> method appears in the table even though it is a standard method for mutable collections. This is because the <span class="EmphasisFontCategoryNonProportional">Sprite Set</span> version of the <span class="EmphasisFontCategoryNonProportional">add</span> method is slightly different. It only adds an element if it would be a new element, and it returns a <span class="EmphasisFontCategoryNonProportional">Boolean</span> result to indicate whether an element was actually added.
<div id="Tab10" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 9-10</span><div class="SimplePara">Additional or modified Sprite Set methods</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Sprite Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">add(sprite : Sprite) : Boolean</span>
                      </div></td><td align="left"><div class="SimplePara">Adds sprite to set if not already present; the result is true if it was not present already.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">add from(old set : Sprite Set,</span>
                      </div><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">sprite : Sprite) : Boolean</span>
                      </div></td><td align="left"><div class="SimplePara">Adds the sprite to the new set and removes it from the old set; the result is true if the sprite was in the old set.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">contains(sprite : Sprite) : Boolean</span>
                      </div></td><td align="left"><div class="SimplePara">Returns true if the sprite is in the set</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">index of(sprite : Sprite) : Number</span>
                      </div></td><td align="left"><div class="SimplePara">Returns the index of the sprite in the set; the result is -1 if not in the set</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">remove first : Sprite</span>
                      </div></td><td align="left"><div class="SimplePara">Removes the sprite which was added to the set before all the others</div></td></tr></tbody></table></div>
          </div></div><div id="Sec17" class="Section1 RenderAsSection1"><h2 class="Heading">9.5 Touching and board events</h2><div class="Para">The board has six specific kinds of events which are covered in the subsections below. All but one of these events are triggered when the user touches the screen and taps, swipes or drags a finger across the board.</div><div id="Sec18" class="Section2 RenderAsSection2"><h3 class="Heading">9.5.1 Board touching actions</h3><div class="Para">In addition to events, the <span class="EmphasisFontCategoryNonProportional">Board</span> datatype provides five methods which provide information about how the screen has been touched. These methods are listed in Table <span class="InternalRef"><a href="#Tab11">9-11</a></span>. However the tap, swipe and drag events explained later in this section are easier to program and their use is recommended.
<div id="Tab11" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 9-11</span><div class="SimplePara">Touch methods of the Board datatype</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Sprite Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">touch current : Vector3</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the coordinates of the current touch point on the board; the z component is 0.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">touch end : Vector3</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the coordinates of the last touch point on the board; the z component is 0</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">touch start : Vector3</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the coordinates of the latest start point for a touch gesture on the board; the z component is 0</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">touch velocity : Vector3</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the final swiping velocity after a touch has gesture; the z component is 0</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">touched : Boolean</span>
                        </div></td><td align="left"><div class="SimplePara">Returns true if the board has been touched</div></td></tr></tbody></table></div>
            </div></div><div id="Sec19" class="Section2 RenderAsSection2"><h3 class="Heading">9.5.2 gameloop event</h3><div class="Para">The <span class="EmphasisFontCategoryNonProportional">gameloop</span> event contains code that needs to be run regularly and frequently. The event is triggered about every 50ms. It is a natural location to contain collision detection code, or to monitor the passage of time.</div><div class="Para">The <span class="EmphasisFontCategoryNonProportional">gameloop</span> event code should be efficient. If it takes too long to execute, the display may stutter and collisions may go undetected.</div></div><div id="Sec20" class="Section2 RenderAsSection2"><h3 class="Heading">9.5.3 tap board event</h3><div class="Para">The <span class="EmphasisFontCategoryNonProportional">tap board</span> event fires if there is tap anywhere on the board except on a position where a sprite is located. Tapping means that one’s finger leaves the screen at approximately the same position as where it first touched. Otherwise, the software will report a swipe event instead. The event fires once the finger is lifted.</div><div class="Para">As an example, the code below creates a new ball wherever there is a tap</div><div class="Para">the board.</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">event</span></span>
              <span class="EmphasisFontCategoryNonProportional">tap board: board(x,y)</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">sprite := ◳board → create ellipse(10,10)</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">sprite → set pos(x,y)</span>
            </div><div class="Para">The <span class="EmphasisFontCategoryNonProportional">tap board</span> event has two parameters <span class="EmphasisFontCategoryNonProportional">x</span> and <span class="EmphasisFontCategoryNonProportional">y</span> which give the position where the tap occurred.</div></div><div id="Sec21" class="Section2 RenderAsSection2"><h3 class="Heading">9.5.4 swipe board event</h3><div class="Para">The <span class="EmphasisFontCategoryNonProportional">swipe board</span> event is similar, except that the event code is passed four parameters. The first two show where the swipe started and the second two show the extent of the swipe in the <span class="EmphasisFontCategoryNonProportional">x</span> and <span class="EmphasisFontCategoryNonProportional">y</span> dimensions.</div><div class="Para">As an example, the code below creates a new sprite and gives it an initial speed which corresponds to the extent of the swipe.</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">event</span></span>
              <span class="EmphasisFontCategoryNonProportional">swipe board: board(x, y, delta x, delta y)</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">sprite := ◳board → create ellipse(10,10)</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">sprite → set pos(x,y)</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">sprite → set speed(delta x, delta y)</span>
            </div></div><div id="Sec22" class="Section2 RenderAsSection2"><h3 class="Heading">9.5.5 tap sprite in XXX event</h3><div class="Para">Tap events can be provided for sprites held in different sprite collections. This makes it easier to program one kind of action for a spaceship, say, and a different kind of action when tapping an asteroid, say.</div><div class="Para">If, for example, there is a global data variable named <span class="EmphasisFontCategoryNonProportional">spaceships</span> with the type <span class="EmphasisFontCategoryNonProportional">Sprite Set</span>, then an event named <span class="EmphasisFontCategoryNonProportional">tap sprite in asteroids</span> can be provided. The event is passed four parameters. These are the sprite which was tapped, the index of the sprite in the sprite set, and the coordinates of the sprite on the board.</div><div class="Para">A sample of code which uses the event is as follows:</div><div class="Para ParaTypeProgramcode">           <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">action</span></span>
              <span class="EmphasisFontCategoryNonProportional">main( )</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">…</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">◳asteroids := ◳board → create sprite set</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">// populate the board with spaceships and asteroids</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">…</span>
            </div><div class="Para ParaTypeProgramcode">           <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">event</span></span>
              <span class="EmphasisFontCategoryNonProportional">tap sprite</span>
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">in</span></span>
              <span class="EmphasisFontCategoryNonProportional">asteroids(sprite, index, x, y)</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">// change the asteroid’s color</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">sprite → set color(colors → red)</span>
            </div></div><div id="Sec23" class="Section2 RenderAsSection2"><h3 class="Heading">9.5.6 swipe sprite in XXX event</h3><div class="Para">The <span class="EmphasisFontCategoryNonProportional">swipe sprite</span> event is similar to the tap sprite event, except that one’s finger is swiped across the screen and the extent of the swipe is passed as two additional parameters. For example, the following code will cause the sprite which is swiped to start moving in the direction of the swipe.</div><div class="Para ParaTypeProgramcode">           <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">event</span></span>
              <span class="EmphasisFontCategoryNonProportional">swipe sprite</span>
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">in</span></span>
              <span class="EmphasisFontCategoryNonProportional">asteroids(sprite, index, x, y, delta x, delta y)</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">sprite → set speed(delta x, delta y)</span>
            </div></div><div id="Sec24" class="Section2 RenderAsSection2"><h3 class="Heading">9.5.7 drag sprite in XXX event</h3><div class="Para">A <span class="EmphasisTypeItalic">drag event</span> does not wait for the finger to be lifted from the screen, as with the tap and swipe events. It fires while one’s finger is still on the screen. It will repeatedly fire while the finger is in motion across the screen. The event is passed very similar parameters to the swipe sprite event, except that the last two parameters provide the extent of the dragging motion (so far).</div><div class="Para">The event can be used to temporarily set the speed of a dragged sprite to 0 and to display it at the current drag position. In this way, it will appear that the sprite is being held at the finger’s position.</div><div class="Para">Here is example coding with the asteroids:</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">event</span></span>
              <span class="EmphasisFontCategoryNonProportional">drag sprite</span>
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">in</span></span>
              <span class="EmphasisFontCategoryNonProportional">asteroids(sprite, index, x, y, delta x, delta y)</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">sprite → set speed(0, 0)</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">sprite → set pos(x, y)</span>
            </div><div class="Para">When the finger is lifted at the end of the motion, a <span class="EmphasisFontCategoryNonProportional">swipe sprite</span> event is triggered (if event code for that action has been provided).</div></div><div id="Sec25" class="Section2 RenderAsSection2"><h3 class="Heading">9.5.8 tap sprite SSS, swipe sprite SSS, drag sprite SSS</h3><div class="Para">Instead of having events associated with sprite sets, it is possible to have events associated with an individual sprite. To do this, the sprite must be promoted to be a global data variable (in the data section of a script).</div><div class="Para">If the data variable is named SSS, then the corresponding event names are <span class="EmphasisFontCategoryNonProportional">tap sprite SSS</span>, <span class="EmphasisFontCategoryNonProportional">swipe sprite SSS</span> and <span class="EmphasisFontCategoryNonProportional">drag sprite SSS</span>.</div></div></div><div id="Sec26" class="Section1 RenderAsSection1"><h2 class="Heading">9.6 Debugging games</h2><div class="Para">To make it a bit simpler to debug sprite position and speed related problems in scripts, the debug mode for the board can be enabled.</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisFontCategoryNonProportional">◳board→set debug mode(true)</span>
          </div><div class="Para">If debug mode is on, the board will display the position and speed of a sprite next to the sprite content. Additionally, the width and height is displayed as a box around the sprite. Also, in debug mode, even invisible sprites are displayed. This can be useful for finding forgotten sprites or where anchors are placed.</div></div></div></body></html>
