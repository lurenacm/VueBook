<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><title>The Web</title><link href="springer_epub.css" type="text/css" rel="styleSheet"/></head><body><div class="ChapterContextInformation"><div class="ContextInformation" id="Chap4"><span class="ContextInformationAuthorEditorNames"><span class="Author"><span class="AuthorName">R. Nigel Horspool</span> and </span><span class="Author"><span class="AuthorName">Nikolai Tillmann</span></span></span><span class="ContextInformationBookTitles"><span class="BookTitle" xml:lang="en">TouchDevelop: Programming on the Go</span><span class="BookEdition">Third Edition</span></span><span class="ChapterDOI">10.1007/978-1-4302-6137-7_4</span><span class="ChapterCopyright">© R. Nigel Horspool 2013</span></div></div><!--Begin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" xml:lang="en">4. The Web</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">R. Nigel Horspool</span><sup>1 <span class="ContactIcon"/></sup> and </span><span class="Author"><span class="AuthorName">Nikolai Tillmann</span><sup>2 <span class="ContactIcon"/></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff1"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Canada, USA</div></div><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(2)</span><div class="AffiliationText">TU Berlin, Germany</div></div><div class="ClearBoth"> </div></div></div><div class="ArticleOrChapterToc"><div class="TocLine"><a href="#Sec1">4.1 URLs and webpages</a></div><div class="TocLine"><a href="#Sec6">4.2 Downloading and uploading files</a></div><div class="TocLine"><a href="#Sec11">4.3 Downloading structured data</a></div><div class="TocLine"><a href="#Sec14">4.4 REST guidelines and web requests</a></div></div><div class="Abstract" id="Abs1" xml:lang="en"><div class="Heading">Abstract</div><div class="Para">Most mobile devices can be connected to the internet, either via a Wi-Fi connection or by using the data services of the cellphone company. Many useful scripts already exist to retrieve information from websites on the internet. By using the facilities of TouchDevelop, you can easily construct the additional scripts which extract the specific information you might need. Another common use of an internet connection is to share information via one’s Twitter or Facebook account. TouchDevelop provides facilities for uploading messages to your account.</div></div><!--End Abstract--><div class="Fulltext"><div class="Para">Most mobile devices can be connected to the internet, either via a Wi-Fi connection or by using the data services of the cellphone company. Many useful scripts already exist to retrieve information from websites on the internet. By using the facilities of TouchDevelop, you can easily construct the additional scripts which extract the specific information you might need. Another common use of an internet connection is to share information via one’s Twitter or Facebook account. TouchDevelop provides facilities for uploading messages to your account.</div><div id="Sec1" class="Section1 RenderAsSection1"><h2 class="Heading">4.1 URLs and webpages</h2><div id="Sec2" class="Section2 RenderAsSection2"><h3 class="Heading">4.1.1 Working with URLs</h3><div class="Para">The TouchDevelop API provides an easy way to interact with software installed on your device to access the web. Most of these interactions begin with a URL. Here is an example of one of the simplest things we can do in a script – opening the web browser at a particular webpage.</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">If not</span></span>
              <span class="EmphasisFontCategoryNonProportional">web→is connected</span>
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">then</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisFontCategoryNonProportional">“Sorry, you don’t have an internet connection!” → post to wall</span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisFontCategoryNonProportional">time → stop</span>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">else</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisFontCategoryNonProportional">// do nothing</span>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisFontCategoryNonProportional">web → browse(“</span>
              <span class="ExternalRef"><a href="http://touchdevelop.com/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional">http://touchdevelop.com</span>
                </span></a></span>
              <span class="EmphasisFontCategoryNonProportional">”)</span>
            </div><div class="Para">Most web interactions in a TouchDevelop script need a URL to specify a web address. Two API methods which assist in working with URLs are listed in Table <span class="InternalRef"><a href="#Tab1">4-1</a></span>. Frequently, it is necessary to include some special characters in a URL.
<div id="Tab1" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 4-1</span><div class="SimplePara">Converting URLs</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">web→url encode(s : String) : String</span>
                        </div></td><td align="left"><div class="SimplePara">Encode special characters so that they can be included in a URL.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">Web→url decode(url : String) : String</span>
                        </div></td><td align="left"><div class="SimplePara">Decodes a URL back to a normal string containing special characters.</div></td></tr></tbody></table></div>
            </div></div><div id="Sec3" class="Section2 RenderAsSection2"><h3 class="Heading">4.1.2 Creating and using web-based links</h3><div class="Para">One use of the <span class="EmphasisFontCategoryNonProportional">Link</span> datatype in TouchDevelop is to save links to people in the form of their email addresses or their phone numbers. This usage is covered in <span class="ExternalRef"><a href="A978-1-4302-6137-7_8_Chapter.html"><span class="RefSource">Chapter 8</span></a></span>. Another use is to save links to materials found on the web, such as videos, pictures, and webpages in general. The web resource in the TouchDevelop API provides methods for creating links in the latter category. Some more methods will search for webpages or web resources and return a collection of links to the results. These methods are listed in Table <span class="InternalRef"><a href="#Tab2">4-2</a></span>.</div><div class="Para">The <span class="EmphasisFontCategoryNonProportional">Link</span> datatype combines additional information with an address such as a URL. It can optionally have an associated name and a location (which is usually relevant for a photograph but is certainly not restricted to photographs). Methods are provided for setting and getting this additional information.</div><div class="Para">Note that no checking on the validity of the URL is performed when the Link instance is created. The URL is simply held as a string, and can be accessed as a string by using the address method.</div><div class="Para">
              <span class="EmphasisTypeBold">Example:</span> The script <span class="EmphasisTypeItalic">flickr search</span> (<span class="EmphasisFontCategoryNonProportional">/atue</span>) provides an example of a library which creates a <span class="EmphasisFontCategoryNonProportional">Link Collection</span> instance containing references to particular kinds of images, and the script <span class="EmphasisTypeItalic">flickr slideshow</span> (<span class="EmphasisFontCategoryNonProportional">/fluo</span>) uses that library to generate a slideshow of images on a theme provided by the user.
<div id="Tab2" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 4-2</span><div class="SimplePara">Creating web links</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">web→link image(url : String) : Link</span>
                        </div></td><td align="left"><div class="SimplePara">Create a link to a picture</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">web→link media(url : String) : Link</span>
                        </div></td><td align="left"><div class="SimplePara">Create a link to an audio file or a video</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">web→link url(name : String, url : String) : Link</span>
                        </div></td><td align="left"><div class="SimplePara">Create a link to a webpage and associate a name with this link</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">web</span>→<span class="EmphasisFontCategoryNonProportional">search(terms : String) :</span>
                        </div><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">Link Collection</span>
                        </div></td><td align="left"><div class="SimplePara">Use Bing to search for webpages matching the search terms</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">web→search images(terms : String) : Link Collection</span>
                        </div></td><td align="left"><div class="SimplePara">Use Bing to search for images matching the search terms</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">web</span>→<span class="EmphasisFontCategoryNonProportional">search images nearby(terms : String, location : Location, distance : Number) :</span>
                        </div><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">Link Collection</span>
                        </div></td><td align="left"><div class="SimplePara">Use Bing to search for images matching the search terms and associated with a location within a given distance of a specified location</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">web</span>→<span class="EmphasisFontCategoryNonProportional">search nearby(terms : String, location : Location, distance : Number) :</span>
                        </div><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">Link Collection</span>
                        </div></td><td align="left"><div class="SimplePara">Use Bing to search for webpages matching the search terms and associated with a location within a given distance of a particular location</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">web→search news(terms : String) : Link Collection</span>
                        </div></td><td align="left"><div class="SimplePara">Use Bing to search for news items matching the search terms</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">web</span>→<span class="EmphasisFontCategoryNonProportional">search news nearby(terms : String, location : Location, distance : Number) :</span>
                        </div><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">Link Collection</span>
                        </div></td><td align="left"><div class="SimplePara">Use Bing to search for news items matching the search terms and associated with a location within a given distance of a specified location</div></td></tr></tbody></table></div>
            </div></div><div id="Sec4" class="Section2 RenderAsSection2"><h3 class="Heading">Using the wall with web-based links</h3><div class="Para">The wall can be used to hold links to websites in general or to various kinds of resources that may be downloaded. For example, to display an image when an instance of the <span class="EmphasisFontCategoryNonProportional">Link</span> type has been provided, code like the following may be used.</div><div class="Para ParaTypeProgramcode">            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// link (of type Link) refers to an image on a website</span></span>
            </div><div class="Para ParaTypeProgramcode">            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">pic := web → download picture(link → address)</span>
            </div><div class="Para ParaTypeProgramcode">            <span class="EmphasisFontCategoryNonProportional">wall → set background picture(pic)</span>
            </div><div class="Para">Here are some more examples. The following script lines (extracted from the script <span class="EmphasisFontCategoryNonProportional">/hrvg</span> held on the TouchDevelop Samples website) demonstrate some interesting possibilities.</div><div class="Para ParaTypeProgramcode">
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// 1. This creates a basic internet link which is opened in the browser</span></span>
            </div><div class="Para ParaTypeProgramcode">
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">//  when the link is tapped</span></span>
            </div><div class="Para ParaTypeProgramcode">
              <span class="EmphasisFontCategoryNonProportional">web → link url("This is a link to TouchDevelop", "</span>
              <span class="ExternalRef"><a href="http://touchdevelop.com/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional">http://touchdevelop.com</span>
                </span></a></span>
              <span class="EmphasisFontCategoryNonProportional">") → post to wall</span>
            </div><div class="Para ParaTypeProgramcode">
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// 2. This will load and display an image from the web</span></span>
            </div><div class="Para ParaTypeProgramcode">
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">//  when the link is tapped</span></span>
            </div><div class="Para ParaTypeProgramcode">
              <span class="EmphasisFontCategoryNonProportional">web → link image("</span>
              <span class="ExternalRef"><a href="http://www.touchdevelop.com/Images/title1.png"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional">http://www.touchdevelop.com/Images/title1.png</span>
                </span></a></span>
              <span class="EmphasisFontCategoryNonProportional">") → post to wall</span>
            </div><div class="Para ParaTypeProgramcode">
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// 3. You can also link to a movie or a sound file through the link</span></span>
            </div><div class="Para ParaTypeProgramcode">
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">//  media method. It will be played when the link is tapped</span></span>
            </div><div class="Para ParaTypeProgramcode">
              <span class="EmphasisFontCategoryNonProportional">web → link media(</span>
            </div><div class="Para ParaTypeProgramcode">
              <span class="EmphasisFontCategoryNonProportional">"</span>
              <span class="ExternalRef"><a href="http://media.ch9.ms/ch9/06b9/1669dae1-2b5f-4858-abee-9ea7018806b9/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional">http://media.ch9.ms/ch9/06b9/1669dae1-2b5f-4858-abee-9ea7018806b9/</span>
                </span></a></span>
            </div><div class="Para ParaTypeProgramcode">
              <span class="EmphasisFontCategoryNonProportional">WP7Pex4FunPeliNikolai_ch9.wmv") → post to wall</span>
            </div><div class="Para">If the first of the examples above is run as a script, the result displayed on the screen looks similar to Figure <span class="InternalRef"><a href="#Fig1">4-1</a></span>. Tapping the ‘<span class="EmphasisTypeBold">go’</span> button on the right causes the webpage to be displayed.
<div class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img src="A978-1-4302-6137-7_4_Fig1_HTML.jpg" alt="A978-1-4302-6137-7_4_Fig1_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 4-1</span><div class="SimplePara">Posting a Webpage Link to the wall</div></div></div></div>
            </div><div class="Para">Running the second example displays the image which is downloaded from the web. The result of running it as a script looks similar to Figure <span class="InternalRef"><a href="#Fig2">4-2</a></span>. (The image looks fuzzy because the original is a small low resolution image which gets scaled up in size before being displayed the screen.)
<div class="Figure" id="Fig2"><div class="MediaObject" id="MO2"><img src="A978-1-4302-6137-7_4_Fig2_HTML.jpg" alt="A978-1-4302-6137-7_4_Fig2_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 4-2</span><div class="SimplePara">Posting a link to an image on the wall</div></div></div></div>
            </div></div><div id="Sec5" class="Section2 RenderAsSection2"><h3 class="Heading">4.1.3 Checking the internet connection</h3><div class="Para">Your device can usually access the internet via a Wi-Fi connection or through a cellphone connection. However there will be occasions when there is no internet connectivity. A script should test whether there is connectivity before proceeding to try to access web resources. The API method call</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisFontCategoryNonProportional">web → is connected</span>
            </div><div class="Para">returns <span class="EmphasisFontCategoryNonProportional">true</span> or <span class="EmphasisFontCategoryNonProportional">false</span> to indicate the current situation.</div><div class="Para">The following API method call should provide information about the kind of connection, if one exists. The result will be one of the strings “<span class="EmphasisFontCategoryNonProportional">unknown</span>” “<span class="EmphasisFontCategoryNonProportional">none</span>” “<span class="EmphasisFontCategoryNonProportional">ethernet</span>” “<span class="EmphasisFontCategoryNonProportional">wifi</span>” or “<span class="EmphasisFontCategoryNonProportional">mobile</span>”.</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisFontCategoryNonProportional">web → connection type</span>
            </div><div class="Para">Finally, the script can discover the name of the Wi-Fi service or the cellphone service which is handling internet requests. The following API method call returns a string with the name of that service, if there is one. If no name can be found, the result is an empty string.</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisFontCategoryNonProportional">web → connection name</span>
            </div></div></div><div id="Sec6" class="Section1 RenderAsSection1"><h2 class="Heading">4.2 Downloading and uploading files</h2><div class="Para">If a script accesses the internet, it is quite likely that information in some form needs to be downloaded. Sometimes information needs to be uploaded too. The TouchDevelop API provides several upload and download methods appropriate for accessing different kinds of web resources. These methods are summarized in Table <span class="InternalRef"><a href="#Tab3">4-3</a></span> and then described in more detail in the following subsections.
<div id="Tab3" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 4-3</span><div class="SimplePara">Uploading/downloading to websites</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">web → download(url : String) : String</span>
                      </div></td><td align="left"><div class="SimplePara">Uses a HTTP GET request to obtain a HTML-encoded webpage as a string.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">web → download json(url : String) : Json Object</span>
                      </div></td><td align="left"><div class="SimplePara">Uses a HTTP GET request to read a JSON data structure</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">web → download picture(url : String) : Picture</span>
                      </div></td><td align="left"><div class="SimplePara">Downloads a picture</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">web → download song(url : String, name : String) : Song</span>
                      </div></td><td align="left"><div class="SimplePara">Creates a streamed song file; the download is delayed until the song is played</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">web → download sound(url : String) : Sound</span>
                      </div></td><td align="left"><div class="SimplePara">Downloads a sound in WAV format</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">web</span> → <span class="EmphasisFontCategoryNonProportional">upload(</span>
                      </div><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">url : String, body : String) : String</span>
                      </div></td><td align="left"><div class="SimplePara">Uses a HTTP POST request to upload string data to a website service; the result is a response string from that service</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">web → upload picture(url : String, pic : Picture): String</span>
                      </div></td><td align="left"><div class="SimplePara">Uses a HTTP POST request to upload a picture to a website service; the result is a response string</div></td></tr></tbody></table></div>
          </div><div id="Sec7" class="Section2 RenderAsSection2"><h3 class="Heading">4.2.1 Downloading a text file or downloading HTML</h3><div class="Para">The simplest format for a web resource is a text file. If the URL ends with the suffix <span class="EmphasisFontCategoryNonProportional">“.txt”</span> or <span class="EmphasisFontCategoryNonProportional">“.text”</span> then the web resource is almost certainly a plain ASCII (or UTF8) text file. However the URL does not necessarily need either of these suffixes to refer to a text file.</div><div class="Para">A webpage which contains HTML is also a text file; it is simply text which includes extra commands to specify the structure and the format of the webpage when displayed by a browser. If it is useful, the raw HTML can be read as though it were a text file.</div><div class="Para">A TouchDevelop script can download a text file or a HTML page and read it into a <span class="EmphasisFontCategoryNonProportional">String</span> variable using script lines similar to those shown in this example:</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">action</span></span>
              <span class="EmphasisFontCategoryNonProportional">main( )</span>
            </div><div class="Para ParaTypeProgramcode">            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">s := web →</span>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisFontCategoryNonProportional">download("</span>
              <span class="ExternalRef"><a href="http://www.smlnj.org/doc/FAQ/faq.txt"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional">http://www.smlnj.org/doc/FAQ/faq.txt</span>
                </span></a></span>
              <span class="EmphasisFontCategoryNonProportional">")</span>
            </div><div class="Para ParaTypeProgramcode">            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">if</span></span>
              <span class="EmphasisFontCategoryNonProportional">s → is invalid</span>
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">then</span></span>
            </div><div class="Para ParaTypeProgramcode">                    <span class="EmphasisFontCategoryNonProportional">"unable to read webpage" → post to wall</span>
            </div><div class="Para ParaTypeProgramcode">            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">else</span></span>
            </div><div class="Para ParaTypeProgramcode">                    <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// … proceed to use the string s</span></span>
            </div><div class="Para ParaTypeProgramcode">                    <span class="EmphasisFontCategoryNonProportional">"" → post to wall</span>
            </div><div class="Para ParaTypeProgramcode">                    <span class="EmphasisFontCategoryNonProportional">s → substring(0,100) → post to wall</span>
            </div><div class="Para ParaTypeProgramcode">                    <span class="EmphasisFontCategoryNonProportional">"First 100 characters are:" → post to wall</span>
            </div><div class="Para ParaTypeProgramcode">                    <span class="EmphasisFontCategoryNonProportional">("Length = " || s → count) → post to wall</span>
            </div><div class="Para">When this script is run, the result looks as shown in Figure <span class="InternalRef"><a href="#Fig3">4-3</a></span>. Most likely, though, your script will proceed to do something more complicated with the string than just display the total length and the first 100 characters.
<div class="Figure" id="Fig3"><div class="MediaObject" id="MO3"><img src="A978-1-4302-6137-7_4_Fig3_HTML.jpg" alt="A978-1-4302-6137-7_4_Fig3_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 4-3</span><div class="SimplePara">Downloading a text file</div></div></div></div>
            </div></div><div id="Sec8" class="Section2 RenderAsSection2"><h3 class="Heading">4.2.2 Downloading a picture</h3><div class="Para">A variety of formats are used for encoding pictures as computer files. The commonly used formats are JPEG, GIF, PNG, BMP, TIFF and WMP. They are all supported by TouchDevelop. If the filename or URL ends with the suffix <span class="EmphasisFontCategoryNonProportional">“.jpg”</span>, <span class="EmphasisFontCategoryNonProportional">“.jpeg”</span>, <span class="EmphasisFontCategoryNonProportional">“.gif”</span>, <span class="EmphasisFontCategoryNonProportional">“.png”</span>, <span class="EmphasisFontCategoryNonProportional">“.bmp”</span> or <span class="EmphasisFontCategoryNonProportional">“.wmp”</span> then one of these formats has been used, and the methods provided in the TouchDevelop API should be able to download and manipulate the picture.</div><div class="Para">The script statements are similar to before, but use a different method so that the result is obtained as a <span class="EmphasisFontCategoryNonProportional">Picture</span> value (and not as a String value).</div><div class="Para ParaTypeProgramcode">    <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">action</span></span>
              <span class="EmphasisFontCategoryNonProportional">main( )</span>
            </div><div class="Para ParaTypeProgramcode">            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">pic := web → download picture(</span>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisFontCategoryNonProportional">"</span>
              <span class="ExternalRef"><a href="http://www.touchdevelop.com/Images/title2.png"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional">http://www.touchdevelop.com/Images/title2.png</span>
                </span></a></span>
              <span class="EmphasisFontCategoryNonProportional">")</span>
            </div><div class="Para ParaTypeProgramcode">            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">if</span></span>
              <span class="EmphasisFontCategoryNonProportional">pic → is invalid</span>
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">then</span></span>
            </div><div class="Para ParaTypeProgramcode">                    <span class="EmphasisFontCategoryNonProportional">"Unable to download picture" → post to wall</span>
            </div><div class="Para ParaTypeProgramcode">            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">else</span></span>
            </div><div class="Para ParaTypeProgramcode">                    <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// … proceed to use the picture pic in some way</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisFontCategoryNonProportional">pic → post to wall</span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisFontCategoryNonProportional">("Image dimensions = " || pic → width || " x " || pic → height) →</span>
            </div><div class="Para ParaTypeProgramcode">         <span class="EmphasisFontCategoryNonProportional">post to wall</span>
            </div><div class="Para">Running this particular script yields the result shown in Figure <span class="InternalRef"><a href="#Fig4">4-4</a></span>.
<div class="Figure" id="Fig4"><div class="MediaObject" id="MO4"><img src="A978-1-4302-6137-7_4_Fig4_HTML.jpg" alt="A978-1-4302-6137-7_4_Fig4_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 4-4</span><div class="SimplePara">Picture download</div></div></div></div>
            </div></div><div id="Sec9" class="Section2 RenderAsSection2"><h3 class="Heading">4.2.3 Downloading sounds and music</h3><div class="Para">TouchDevelop and the Windows phone software support two kinds of audio files – short sound clips and longer audio tracks which would usually contain music (or spoken voice). In TouchDevelop, these correspond to values with type <span class="EmphasisFontCategoryNonProportional">Sound</span> and type <span class="EmphasisFontCategoryNonProportional">Song</span> respectively.</div><div class="Para">If the filename or URL ends with the suffix “.wav” then the file contents are in the ‘Waveform Audio File’ (WAV) format and it is material that can be downloaded as a <span class="EmphasisFontCategoryNonProportional">Sound</span> value. A <span class="EmphasisFontCategoryNonProportional">Sound</span> value can <span class="EmphasisTypeItalic">only</span> be created from a WAV file. If the suffix is <span class="EmphasisFontCategoryNonProportional">“.mp3</span>
              <span class="EmphasisFontCategoryNonProportional">”</span> then the material is in an audio format commonly used for music and the spoken word. This material can be downloaded as a <span class="EmphasisFontCategoryNonProportional">Song</span> value.</div><div class="Para">Some code to download and play a sound effect is shown below. (The sound effect used in this example comes from the website “Partners in Rhyme” which provides royalty-free music and sound-effects.)</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">action</span></span>
              <span class="EmphasisFontCategoryNonProportional">getSound( )</span>
            </div><div class="Para ParaTypeProgramcode">            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">snd := web → download sound( "</span>
              <span class="ExternalRef"><a href="http://www.sound-effect.com/pirsounds/WEB_DESIGN_SOUNDS_WAV1/SOUNDFX/TOYLASER.WAV"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional">http://www.sound-effect.com/pirsounds/WEB_DESIGN_SOUNDS_WAV1/SOUNDFX/TOYLASER.WAV</span>
                </span></a></span>
              <span class="EmphasisFontCategoryNonProportional">" )</span>
            </div><div class="Para ParaTypeProgramcode">            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">if</span></span>
              <span class="EmphasisFontCategoryNonProportional">snd → is invalid</span>
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">then</span></span>
            </div><div class="Para ParaTypeProgramcode">                    <span class="EmphasisFontCategoryNonProportional">"unable to download sound" → post to wall</span>
            </div><div class="Para ParaTypeProgramcode">            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">else</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// … proceed to use the sound value snd</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisFontCategoryNonProportional">snd → set volume(0.7)</span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisFontCategoryNonProportional">snd → play</span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisFontCategoryNonProportional">("Duration = " || snd → duration) → post to wall</span>
            </div><div class="Para">Example: A script to access and play a song is available as <span class="EmphasisTypeItalic">Stream mp3 from internet</span> (<span class="EmphasisFontCategoryNonProportional">/ncwo</span>). The script includes some extra features to make it a bit more useful. These are events to suspend the playback and to stop the playback permanently. When the script is run, the URL can be provided as an argument. If no URL is provided, the last used URL is used again.</div></div><div id="Sec10" class="Section2 RenderAsSection2"><h3 class="Heading">4.2.4 Uploading strings and files</h3><div class="Para">Two API methods are available for uploading material to a website. One method uploads a string and the other uploads a picture. Both use the HTPP POST protocol for the uploads. Typically, uploads will be performed when interacting with a website which follows the REST guidelines (as covered below).</div><div class="Para">Here are sample statements which use the API method call for uploading a string.</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">info := “name=an+other&amp;age=37&amp;car=Ford+Mustang”</span>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// upload key-value pairs in the info string to website specified by the url</span></span>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">response string := web → upload( url, info )</span>
            </div><div class="Para">The website which receives the POST request will pass the string onto a program for processing and a string returned by the program comes back as the result of this API call.</div><div class="Para">Uploading a picture is similar. The sample script <span class="EmphasisTypeItalic">web stuff</span> (<span class="EmphasisFontCategoryNonProportional">/hrvg</span>) is an example of uploading a picture of a QR code in the JPEG format to a website.</div></div></div><div id="Sec11" class="Section1 RenderAsSection1"><h2 class="Heading">4.3 Downloading structured data</h2><div class="Para">The internet makes a wealth of information available to your script. The difficult part is in extracting the information you need from a website. Suppose that you want your script to look up the current temperature in some location. There are many websites you could use to find this information, one of them is <span class="ExternalRef"><a href="http://local.msn.com/"><span class="RefSource">
                <span class="EmphasisFontCategoryNonProportional">local.msn.com</span>
              </span></a></span>. For example, if you point your browser at the URL <span class="ExternalRef"><a href="http://local.msn.com/weather.aspx?q=redmond-wazip=98052"><span class="RefSource">
                <span class="EmphasisFontCategoryNonProportional">http://local.msn.com/weather.aspx?q=redmond-wa&amp;zip=98052</span>
              </span></a></span>, it will display a webpage containing much information about current weather conditions in Redmond, but where only a tiny part of the page shows the temperature. A snapshot showing just a small part of this web page is reproduced in Figure <span class="InternalRef"><a href="#Fig5">4-5</a></span>.</div><div class="Para">We can, in principle, use the API call <span class="EmphasisFontCategoryNonProportional">web</span>→<span class="EmphasisFontCategoryNonProportional">download</span> to fetch the HTML code for the webpage as one very long string of characters. Then we can write some statements which search the HTML code for the little snippet of information that we need. In this example, we need to search the code for a sequence of characters with a structure like the following.</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisFontCategoryNonProportional">&lt;span class="curtemp"&gt;53°F&lt;/span&gt;</span>
          </div><div class="Para">Here the two <span class="EmphasisTypeItalic">characters</span> ‘53’ are the data we want to extract and convert to the <span class="EmphasisTypeItalic">number</span> 53. You have to study the HTML code for the website to figure out what sequence of characters would be sufficient to accomplish the task, and no two websites are going to be the same. The script may also need to untranslate characters which have been replaced by HTML escape sequences. For example, an ampersand character displayed on a webpage appears in the HTML code as the five characters <span class="EmphasisFontCategoryNonProportional">“&amp;amp;”</span>. The API provides two methods for converting between special characters and their HTML escape sequences. These are <span class="EmphasisFontCategoryNonProportional">web</span>→<span class="EmphasisFontCategoryNonProportional">html decode</span> and <span class="EmphasisFontCategoryNonProportional">web</span>→<span class="EmphasisFontCategoryNonProportional">html encode.</span>
            <div class="Figure" id="Fig5"><div class="MediaObject" id="MO5"><img src="A978-1-4302-6137-7_4_Fig5_HTML.jpg" alt="A978-1-4302-6137-7_4_Fig5_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 4-5</span><div class="SimplePara">Snapshot of a weather webpage</div></div></div></div>
          </div><div class="Para">The kind of programming which analyzes webpages to extract information is known as <span class="EmphasisTypeItalic">web scraping</span> (or <span class="EmphasisTypeItalic">web harvesting</span>). You should write code like this only if there is no alternative and, even then, think twice. This is a job best left for professionals who have access to special software, and it is a job which has to be repeated whenever the web designers choose to change the layout of the website being accessed.</div><div class="Para">What can we do instead? The best answer is to find an internet site which serves up the information you need in a more easily digestible format. Two formats, widely used for delivering information in a systematic and simple manner, are XML and JSON.</div><div class="Para">Both these formats are supported by TouchDevelop, and will be explained with simple examples in the following sections of this chapter. In the particular case where we need to find the current weather in some location, there are several suitable websites. One of them is ‘The Weather Channel’ but, unfortunately access to this service requires a monthly subscription. A free alternative is Weather2 which supplies both JSON and XML: <span class="ExternalRef"><a href="http://www.myweather2.com/developer/"><span class="RefSource">
                <span class="EmphasisFontCategoryNonProportional">http://www.myweather2.com/developer/</span>
              </span></a></span>
          </div><div id="Sec12" class="Section2 RenderAsSection2"><h3 class="Heading">4.3.1 Downloading information in JSON format</h3><div class="Para">JSON is short for <span class="EmphasisTypeItalic">JavaScript Object Notation</span>. It is a text format which borrows notations and data structuring ideas from the JavaScript scripting language. It is a format which has been designed to be easy for processing by computer software (and therefore by TouchDevelop scripts too), but is human-readable too.</div><div class="Para">An example of some data expressed in JSON format appears in Figure <span class="InternalRef"><a href="#Fig6">4-6</a></span>. It is weather data obtained from the weather2 service.</div><div class="Para">There are only a few simple rules for what constitutes a valid JSON representation of information. A file in JSON format contains the following elements.
<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><div class="Para">Numbers and Strings</div></li><li><div class="Para">Boolean values (true or false)</div></li><li><div class="Para">Arrays – written as a sequence of array elements separated by commas, with the whole sequence enclose in square brackets</div></li><li><div class="Para">Objects – written as an unordered collection of key-value pairs where a colon separates each key from the value, each pair is separated from the next by a comma, and the whole collection is enclosed in curly braces; the keys must be written as strings and they must be distinct from each other.</div></li><li><div class="Para">The special value <span class="EmphasisTypeItalic">null</span>, meaning empty.</div></li></ul></div>
            </div><div class="Para">Referring back to Figure <span class="InternalRef"><a href="#Fig6">4-6</a></span>, we can see that the figure shows an object with just one key-value pair, where the key is “weather” and the associated value is another object. That object contains two key-value pairs; one key is <span class="EmphasisFontCategoryNonProportional">“curren_weather”</span> and the other is <span class="EmphasisFontCategoryNonProportional">“forecast”</span>. The value associated with <span class="EmphasisFontCategoryNonProportional">“curren_weather”</span> is an array that contains just one element, which is an object. The value associated with “forecast” is an array containing two elements, and the two elements are objects with identical structures. (The elements do not need to have the same structure, or even have the same types, but processing the JSON file is easier if they do.)
<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><div class="Para">If we have found a website which provides results in JSON format, we can access it using the call <span class="EmphasisFontCategoryNonProportional">web→download json</span>. Here is an example invocation.</div></li></ul></div>
              <div class="Figure" id="Fig6"><div class="MediaObject" id="MO6"><img src="A978-1-4302-6137-7_4_Fig6_HTML.jpg" alt="A978-1-4302-6137-7_4_Fig6_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 4-6</span><div class="SimplePara">Weather data in JSON format</div></div></div></div>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">jobj := web→download json(</span>
            </div><div class="Para ParaTypeProgramcode">    <span class="EmphasisFontCategoryNonProportional">"</span>
              <span class="ExternalRef"><a href="http://www.myweather2.com/developer/forecast.ashx?uac=X"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional">http://www.myweather2.com/developer/forecast.ashx?uac=X</span>
                </span></a></span>
              <span class="EmphasisFontCategoryNonProportional">&amp;</span>
            </div><div class="Para ParaTypeProgramcode">    <span class="EmphasisFontCategoryNonProportional">output=json&amp;query=SW1")</span>
            </div><div class="Para">It will download JSON data similar to that shown in Figure <span class="InternalRef"><a href="#Fig6">4-6</a></span>. (The ‘X’ shown after <span class="EmphasisFontCategoryNonProportional">‘uac=’</span> in the URL must be replaced by a user access code which is given to you only if you register with the weather2 website.)</div><div class="Para">The value retrieved by this API call has the data type <span class="EmphasisFontCategoryNonProportional">Json Object</span>. The data type provides many methods for accessing information from inside a JSON object. These methods are listed in Appendix C. Using these methods, here is how we could obtain today’s temperature from the JSON object shown in Figure <span class="InternalRef"><a href="#Fig6">4-6</a></span>. The code is shown as a series of very simple steps.</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// assume jobj has been read using the call previously shown</span></span>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">if</span></span>
              <span class="EmphasisFontCategoryNonProportional">jobj → is invalid</span>
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">then</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisFontCategoryNonProportional">"unable to download JSON data" → post to wall</span>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">else</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">w := jobj → field("weather")</span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">cw := w → field("curren_weather")</span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// get first element of array</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">cw0 := cw → at(0)</span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// get temperature as a Number</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">temp := cw0 → string("temp") → to number</span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// get temperature units as a String</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">units := cw0 → string("temp_unit")</span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisFontCategoryNonProportional">("Today’s temperature is " || temp || units) → post to wall</span>
            </div><div class="Para">All we had to do was look at one example of the JSON data produced by our weather query. From that example, it was easy to figure out how to extract the information we needed. (Of course, we could have also read the documentation provided by the service provider.)</div><div class="Para">Two popular services which provide results in the JSON format are <span class="EmphasisTypeItalic">Flickr</span> and <span class="EmphasisTypeItalic">Twitter</span>. Two scripts in the TouchDevelop Samples collections implement libraries for using these services. A trivial script which searches for tweets containing a particular keyword (or #tag) is shown in Figure <span class="InternalRef"><a href="#Fig7">4-7</a></span>.</div><div class="Para">The code for the library can be found under the name <span class="EmphasisTypeItalic">twitter search</span> (<span class="EmphasisFontCategoryNonProportional">/stlm</span>). It extracts enough information from each tweet to format it as a message with an author name, a picture of the author, the date when the tweet was posted, plus the message itself.</div></div><div id="Sec13" class="Section2 RenderAsSection2"><h3 class="Heading">4.3.2 Downloading information in XML format</h3><div class="Para">XML is short for <span class="EmphasisTypeItalic">Extensible Markup Language</span>. It is a notation for adding markup to a text document so as to show its structure. It provides an alternative to JSON for delivering results from web services in a format which can easily be processed by software and which is moderately easy for a human to read.
<div class="Figure" id="Fig7"><div class="MediaObject" id="MO7"><img src="A978-1-4302-6137-7_4_Fig7_HTML.jpg" alt="A978-1-4302-6137-7_4_Fig7_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 4-7</span><div class="SimplePara">Accessing Twitter with a library</div></div></div></div>
            </div><div class="Para">An incomplete example of the XML produced by the <span class="EmphasisTypeItalic">weather2</span> service is shown in Figure <span class="InternalRef"><a href="#Fig8">4-8</a></span>. The information is the same as shown in Figure <span class="InternalRef"><a href="#Fig6">4-6</a></span> but, because it is rather more voluminous, only the first 25 lines are displayed. As seen in the example, the start of a component (a logical unit) in the document is flagged by an opening tag such as <span class="EmphasisFontCategoryNonProportional">&lt;weather&gt;</span>. The end of that component is flagged by a matching close tag such as <span class="EmphasisFontCategoryNonProportional">&lt;/weather&gt;</span>. The components can be nested, as seen in the figure.</div><div class="Para">An opening tag can include attributes, such as this one <span class="EmphasisFontCategoryNonProportional">&lt;font name=”Courier” size=”12”&gt;</span>, though this possibility does not occur in the weather data.</div><div class="Para">Downloading XML data requires a call to <span class="EmphasisFontCategoryNonProportional">web</span>→<span class="EmphasisFontCategoryNonProportional">download</span> to fetch the data as a string, and then a call to <span class="EmphasisFontCategoryNonProportional">web</span>→<span class="EmphasisFontCategoryNonProportional">xml</span> to parse the string as XML, as in the following example.</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">xobj := web→xml( web→download( "</span>
              <span class="ExternalRef"><a href="http://www.myweather2.com/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional">http://www.myweather2.com/</span>
                </span></a></span>
            </div><div class="Para ParaTypeProgramcode">
              <span class="EmphasisFontCategoryNonProportional">developer/forecast.ashx?uac=X&amp;output=xml&amp;query=SW1"))</span>
            </div><div class="Para">The result of the code is a value with the datatype <span class="EmphasisFontCategoryNonProportional">Xml Object</span>. This datatype provides methods for traversing the XML object and extracting various components. The methods are listed in Appendix C.</div><div class="Para">Extracting the current temperature from XML shown in Figure <span class="InternalRef"><a href="#Fig8">4-8</a></span> can be programmed as follows.
<div class="Figure" id="Fig8"><div class="MediaObject" id="MO8"><img src="A978-1-4302-6137-7_4_Fig8_HTML.jpg" alt="A978-1-4302-6137-7_4_Fig8_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 4-8</span><div class="SimplePara">Weather data in JSON format</div></div></div></div>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// assume xobj has been read using the call previously shown</span></span>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">if</span></span>
              <span class="EmphasisFontCategoryNonProportional">xobj → is invalid</span>
              <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">then</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisFontCategoryNonProportional">"unable to download XML data" → post to wall</span>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">else</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">cw := xobj → child("curren_weather")</span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// get temperature</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">temp := cw → child("temp") → to string</span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">// get temperature units</span></span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">units := cw → child("temp_unit") → to string</span>
            </div><div class="Para ParaTypeProgramcode">                <span class="EmphasisFontCategoryNonProportional">("Today’s temperature is " || temp || units) → post to wall</span>
            </div><div class="Para">As with JSON, it is fairly easy to figure out how to extract the desired information just by looking at an example of the XML data. However, the structure of the XML is almost always rigidly defined by a DTD (Document Type Definition) which specifies the tag names to use and how they are allowed to nest inside other tagged sections. It is preferable to consult the DTD when developing scripts for processing XML.</div></div></div><div id="Sec14" class="Section1 RenderAsSection1"><h2 class="Heading">4.4 REST guidelines and web requests</h2><div class="Para">Many web services implement those services in a manner which follows guidelines known as REST. It is short for <span class="EmphasisTypeItalic">REpresentational State Transfer</span>. Such a web service is often described as being RESTful. A starting point for reading about the REST guidelines is provided by Wikipedia at this URL: <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/REST"><span class="RefSource">
                <span class="EmphasisFontCategoryNonProportional">http://en.wikipedia.org/wiki/REST</span>
              </span></a></span>.</div><div class="Para">In particular, HTTP GET and POST requests are used to access many of the facilities of a RESTful web service and the API calls provided for uploading and downloading to or from the web may be adequate. The HTTP PUT and DELETE requests are not supported on the Windows Phone platform and therefore cannot be generated by a TouchDevelop script. Many RESTful web services provide alternatives to the PUT and DELETE requests.</div><div class="Para">The API method <span class="EmphasisFontCategoryNonProportional">web</span>→<span class="EmphasisFontCategoryNonProportional">create request</span> may be used to construct a general HTTP request. The request is constructed as an instance of the <span class="EmphasisFontCategoryNonProportional">Web Request</span> datatype. When the request is sent to the web service, the result comes back as an instance of the <span class="EmphasisFontCategoryNonProportional">Web Response</span> type. The methods of these two datatypes are summarized in Table <span class="InternalRef"><a href="#Tab4">4-4</a></span> and Table <span class="InternalRef"><a href="#Tab5">4-5</a></span>. (Methods available for all datatypes are omitted from these two tables.)
<div id="Tab4" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 4-4</span><div class="SimplePara">Methods of Web Request datatype</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">header(name : String) : String</span>
                      </div></td><td align="left"><div class="SimplePara">Gets the value of a header identified by name</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">header names : String Collection</span>
                      </div></td><td align="left"><div class="SimplePara">Gets the names of all the headers</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">method : String</span>
                      </div></td><td align="left"><div class="SimplePara">Returns the HTML method: “get” or “post”</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">send : Web Response</span>
                      </div></td><td align="left"><div class="SimplePara">Sends the request and waits for a response</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">set compress(value : Boolean) : Nothing</span>
                      </div></td><td align="left"><div class="SimplePara">If the argument is true, the request content is compressed with gzip (and the header is updated).</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">set content(content : String) : Nothing</span>
                      </div></td><td align="left"><div class="SimplePara">Sets the content of a POST request</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">set content as json(json : Json Object) : Nothing</span>
                      </div></td><td align="left"><div class="SimplePara">Sets the content of a POST request as a JSON data structure</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">set content as picture(picture : Picture, quality : Number) : Nothing</span>
                      </div></td><td align="left"><div class="SimplePara">Sets the content of a POST request as a JPEG image; the quality parameter ranges from 0 for low quality (maximum compression) to 1 for best quality.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">set content as xml(xml : Xml Object): Nothing</span>
                      </div></td><td align="left"><div class="SimplePara">Sets the content of a POST request as an XML data structure</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">set credentials(name : String,password : String): Nothing</span>
                      </div></td><td align="left"><div class="SimplePara">Sets the name and password when the website requires authentication; the URL for the request must specify HTTPS protocol.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">set header( name : String,</span>
                      </div><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">value : String): Nothing</span>
                      </div></td><td align="left"><div class="SimplePara">Sets a HTML header value.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">set method( method : String) : Nothing</span>
                      </div></td><td align="left"><div class="SimplePara">Sets the method; it must be “get” or “post”.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">set url(url : String) : Nothing</span>
                      </div></td><td align="left"><div class="SimplePara">Sets the URL.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">url : String</span>
                      </div></td><td align="left"><div class="SimplePara">Returns the URL used in this request</div></td></tr></tbody></table></div>
          </div><div class="Para">An example of constructing a web request and using the response is provided by the script <span class="EmphasisTypeItalic">cosm services</span> (<span class="EmphasisFontCategoryNonProportional">/ybnr</span>).
<div id="Tab5" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 4-5</span><div class="SimplePara">Methods of Web Response datatype</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">content : String</span>
                      </div></td><td align="left"><div class="SimplePara">Gets the content of the response body as a string</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">content as json : Json Object</span>
                      </div></td><td align="left"><div class="SimplePara">Gets the content of the response body as a JSON data structure</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">content as picture : Picture</span>
                      </div></td><td align="left"><div class="SimplePara">Gets the content of the response body as a picture</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">content as sound : Sound</span>
                      </div></td><td align="left"><div class="SimplePara">Gets the content of the response body as a sound in WAV format</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">content as xml : Xml Object</span>
                      </div></td><td align="left"><div class="SimplePara">Gets the content of the response body as an XML structure</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">header(name : String) : String</span>
                      </div></td><td align="left"><div class="SimplePara">Gets value of the HTML header with the given name</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">header names : String Collection</span>
                      </div></td><td align="left"><div class="SimplePara">Gets the names of the headers</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">request : Web Request</span>
                      </div></td><td align="left"><div class="SimplePara">Gets the web request which was used</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                        <span class="EmphasisFontCategoryNonProportional">status code : Number</span>
                      </div></td><td align="left"><div class="SimplePara">Gets the HTTP status code associated with the request</div></td></tr></tbody></table></div>
          </div></div></div></body></html>
