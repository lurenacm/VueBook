<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><title>Camera, Graphics and Video</title><link href="springer_epub.css" type="text/css" rel="styleSheet"/></head><body><div class="ChapterContextInformation"><div class="ContextInformation" id="Chap6"><span class="ContextInformationAuthorEditorNames"><span class="Author"><span class="AuthorName">R. Nigel Horspool</span> and </span><span class="Author"><span class="AuthorName">Nikolai Tillmann</span></span></span><span class="ContextInformationBookTitles"><span class="BookTitle" xml:lang="en">TouchDevelop: Programming on the Go</span><span class="BookEdition">Third Edition</span></span><span class="ChapterDOI">10.1007/978-1-4302-6137-7_6</span><span class="ChapterCopyright">© R. Nigel Horspool 2013</span></div></div><!--Begin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" xml:lang="en">6. Camera, Graphics and Video</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">R. Nigel Horspool</span><sup>1 <span class="ContactIcon"/></sup> and </span><span class="Author"><span class="AuthorName">Nikolai Tillmann</span><sup>2 <span class="ContactIcon"/></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff1"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Canada, USA</div></div><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(2)</span><div class="AffiliationText">TU Berlin, Germany</div></div><div class="ClearBoth"> </div></div></div><div class="ArticleOrChapterToc"><div class="TocLine"><a href="#Sec1">6.1 Camera</a></div><div class="TocLine"><a href="#Sec3">6.2 Working with pictures</a></div><div class="TocLine"><a href="#Sec10">6.3 Static graphics drawing and display</a></div><div class="TocLine"><a href="#Sec11">6.4 Playing videos from the internet</a></div></div><div class="Abstract" id="Abs1" xml:lang="en"><div class="Heading">Abstract</div><div class="Para">A smartphones, tablets and laptops are commonly used for displaying photographs and videos. TouchDevelop scripts provide new ways to download, create, modify and display photographs. Scripts can be used to record videos using the device’s camera and to play back both those videos and videos obtained from elsewhere.</div></div><!--End Abstract--><div class="Fulltext"><div class="Para">A smartphones, tablets and laptops are commonly used for displaying photographs and videos. TouchDevelop scripts provide new ways to download, create, modify and display photographs. Scripts can be used to record videos using the device’s camera and to play back both those videos and videos obtained from elsewhere.</div><div id="Sec1" class="Section1 RenderAsSection1"><h2 class="Heading">6.1 Camera</h2><div class="Para">Smartphones, tablets and most laptops have at least one camera capable of taking high-quality pictures or videos. This is the <span class="EmphasisTypeItalic">primary camera</span>. On a phone or tablet, it would normally be located on the opposite side from the screen. Many of these devices have a second camera located above the screen which captures the user’s image and is intended for use in video calls, such as a Skype call. A camera above the screen is normally the only one provided on a laptop, and would be considered to be the primary camera by TouchDevelop.</div><div class="Para">The TouchDevelop API provides access to the camera (or cameras) via its senses service. The <span class="EmphasisFontCategoryNonProportional">senses</span> methods relevant to using the cameras are listed in Table <span class="InternalRef"><a href="#Tab1">6-1</a></span>. Two of these methods return instances of type <span class="EmphasisFontCategoryNonProportional">Camera</span>. This datatype provides methods for retrieving information about the camera and for taking a quick low-quality picture on a smartphone.
<div id="Tab1" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 6-1</span><div class="SimplePara">Methods for using the camera(s)</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">senses → camera: Camera</div></td><td align="left"><div class="SimplePara">Returns the primary camera, if there is one; otherwise the result is invalid.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">senses → front camera: Camera</div></td><td align="left"><div class="SimplePara">Returns the secondary camera, if there is one; otherwise the result is <span class="EmphasisTypeItalic">invalid.</span>
                      </div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">senses → take camera picture: Picture</div></td><td align="left"><div class="SimplePara">Uses the primary camera to take a picture.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">wall → set background camera( camera: Camera): Nothing</div></td><td align="left"><div class="SimplePara">Causes images from the selected camera to be used as the background for the wall</div></td></tr></tbody></table></div>
          </div><div class="Para">There are two ways to take a picture with the primary camera. The two approaches behave differently on a phone, but will normally behave identically on a laptop or tablet. The two forms are</div><div class="Para ParaTypeProgramcode">           <span class="EmphasisFontCategoryNonProportional">senses</span> → <span class="EmphasisFontCategoryNonProportional">take camera picture</span>
          </div><div class="Para">and</div><div class="Para ParaTypeProgramcode">           <span class="EmphasisFontCategoryNonProportional">senses</span> → <span class="EmphasisFontCategoryNonProportional">front camera</span>  →  <span class="EmphasisFontCategoryNonProportional">preview</span>
          </div><div class="Para">On a Windows phone, the first form takes a high-resolution picture using the phone’s built-in software. This causes a preview image to appear on the screen along with controls for adjusting the zoom level, exposure and flash etc. Control is not returned to the TouchDevelop script until the button to take the picture has been pressed and the picture taken. The second form just returns the preview image without any delay. On other devices, the two forms will both take pictures almost immediately and with the same resolution. The user may be prompted to allow or deny the script access to the camera.</div><div class="Para">All methods (except for invalid and post to wall) are listed in Table <span class="InternalRef"><a href="#Tab2">6-2</a></span>.</div><div class="Para">The user has the option of cancelling the picture capture in the high-quality version on a phone. Therefore the normal pattern of usage in a script might be code like the following. (An audible warning, such as beeps, to indicate when the picture is about to be snapped would be a useful addition to the script.)</div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">“You have three seconds!”</span> → <span class="EmphasisFontCategoryNonProportional">post to wall</span>
          </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">// give 3 seconds for user to get ready</span>
          </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">time</span> → <span class="EmphasisFontCategoryNonProportional">sleep(3)</span>
          </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
            <span class="EmphasisFontCategoryNonProportional">pic := senses</span> → <span class="EmphasisFontCategoryNonProportional">take camera picture</span>
          </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">if not</span></span>
            <span class="EmphasisFontCategoryNonProportional">pic</span> → <span class="EmphasisFontCategoryNonProportional">is invalid</span>
            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">then</span></span>
          </div><div class="Para ParaTypeProgramcode">                       <span class="EmphasisFontCategoryNonProportional">// use the picture pic</span>
          </div><div class="Para ParaTypeProgramcode">                       <span class="EmphasisFontCategoryNonProportional">…</span>
          </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">else</span></span>
          </div><div class="Para ParaTypeProgramcode">                       <span class="EmphasisFontCategoryNonProportional">// user cancelled the picture</span>
          </div><div class="Para">To determine whether the device has a secondary camera, a script should invoke the senses → front camera method. (The name of this method is perhaps inappropriate for a laptop or PC.) If the result is the invalid value, then this camera is absent.
<div id="Tab2" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 6-2</span><div class="SimplePara">Methods of the Camera datatype</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Method</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">height : Number</div></td><td align="left"><div class="SimplePara">Returns the height of the camera image in pixels.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">is front : Boolean</div></td><td align="left"><div class="SimplePara">Returns true if this is the secondary camera, false if this is the primary camera.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">preview : Picture</div></td><td align="left"><div class="SimplePara">Takes a low quality picture with the camera, returning the picture immediately.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">width : Number</div></td><td align="left"><div class="SimplePara">Returns the width of the camera image in pixels.</div></td></tr></tbody></table></div>
          </div><div id="Sec2" class="Section2 RenderAsSection2"><h3 class="Heading">6.1.1 A sample program</h3><div class="Para">The script <span class="EmphasisTypeItalic">the poor man’s camcorder</span> (<span class="EmphasisFontCategoryNonProportional">/ptxfa</span>) asks you to sweep the camera slowly around while it takes 10 pictures in succession using the <span class="EmphasisFontCategoryNonProportional">preview</span> method of the <span class="EmphasisFontCategoryNonProportional">Camera</span> type. It then plays back the 10 pictures, giving the effect of a camcorder whose recordings are 2 seconds long.</div><div class="Para">A simplified and reprogrammed version of this script is presented in Figure <span class="InternalRef"><a href="#Fig1">6-1</a></span>.</div><div class="Para">This sample program also illustrates the use of an <span class="EmphasisTypeBold">object</span> declaration in the Records section of a script. It is used to create a data structure known as a <span class="EmphasisTypeItalic">cyclic list</span>. It is a linked-list where every element of the list contains a reference to the next element, except that the last element references the first element, creating a cycle.
<div class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img src="A978-1-4302-6137-7_6_Fig1_HTML.jpg" alt="A978-1-4302-6137-7_6_Fig1_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 6-1</span><div class="SimplePara">A simplified camcorder script (/xbhl)</div></div></div></div>
            </div></div></div><div id="Sec3" class="Section1 RenderAsSection1"><h2 class="Heading">6.2 Working with pictures</h2><div id="Sec4" class="Section2 RenderAsSection2"><h3 class="Heading">6.2.1 Picture albums and picture collections (Windows Phone and Android)</h3><div class="Para">A smartphone normally holds various picture albums. On a Windows phone, they have names such as <span class="EmphasisTypeItalic">Camera Roll</span> and <span class="EmphasisTypeItalic">Saved Favorites</span>.</div><div class="Para">TouchDevelop provides access to these albums on the Windows Phone and will soon provide access to picture albums on Android devices. Unfortunately, security restrictions prevent access on the PC, Mac, Linux, iPad, iPhone and iPod Touch platforms.</div><div class="Para">On the platforms where it is supported, the API call</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisFontCategoryNonProportional">phone</span> → <span class="EmphasisFontCategoryNonProportional">picture albums</span>
            </div><div class="Para">retrieves all the albums currently maintained on the phone, while the two method calls</div><div class="Para ParaTypeProgramcode">        <span class="EmphasisFontCategoryNonProportional">phone</span> → <span class="EmphasisFontCategoryNonProportional">pictures</span>
            </div><div class="Para ParaTypeProgramcode">        <span class="EmphasisFontCategoryNonProportional">phone</span> → <span class="EmphasisFontCategoryNonProportional">saved pictures</span>
            </div><div class="Para">return collections of all pictures, and the pictures held in the album named ‘saved pictures’, respectively. The methods for working with the Picture Album, Picture Albums and Pictures (a Picture collection) datatypes are listed in Table <span class="InternalRef"><a href="#Tab3">6-3</a></span>.</div><div class="Para">Once a <span class="EmphasisFontCategoryNonProportional">Picture</span> value has been obtained, perhaps by retrieving it from a collection, or by using the camera, there are many methods for manipulating the picture before it is displayed on the screen. These are covered in later sections of this chapter.
<div id="Tab3" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 6-3</span><div class="SimplePara">Methods of Picture Album and Pictures datatypes (WP8 and Android)</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Methods of Picture Album Datatype</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">albums : Picture Albums</span>
                        </div></td><td align="left"><div class="SimplePara">Returns a collection of all the nested albums held inside this album.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">name : String</span>
                        </div></td><td align="left"><div class="SimplePara">Obtains the name of the album.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">pictures : Pictures</span>
                        </div></td><td align="left"><div class="SimplePara">Returns a collection of all the pictures held in the album.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisTypeBold">Methods of Pictures Datatype</span>
                        </div></td><td align="left"><div class="SimplePara">
                          <span class="EmphasisTypeBold">Description</span>
                        </div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">find(name : String) : Number</span>
                        </div></td><td align="left"><div class="SimplePara">Returns the index of a picture in the collection which has the given name; the result is -1 if the picture cannot be found.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">random : Picture</span>
                        </div></td><td align="left"><div class="SimplePara">Returns a random picture.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional">thumbnail(index : Number) : Picture</span>
                        </div></td><td align="left"><div class="SimplePara">Returns a thumbnail of the picture at the given index position in the collection.</div></td></tr></tbody></table></div>
            </div></div><div id="Sec5" class="Section2 RenderAsSection2"><h3 class="Heading">6.2.2 Access to pictures on other devices</h3><div class="Para">In the Web App version of TouchDevelop, a single picture can be selected from the device’s hard drive using the method <span class="EmphasisFontCategoryNonProportional">media</span> → <span class="EmphasisFontCategoryNonProportional">choose picture</span>. A picture can also be downloaded from the web via the call</div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">Var pic := web</span> →  <span class="EmphasisFontCategoryNonProportional">choose picture</span>
            </div><div class="Para">or added to a script as an Art resource.</div></div><div id="Sec6" class="Section2 RenderAsSection2"><h3 class="Heading">6.2.3 Manipulating a picture</h3><div class="Para">Display of an image uses the <span class="EmphasisFontCategoryNonProportional">post to wall</span> method, as in this example.</div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">pic1 := media</span> → <span class="EmphasisFontCategoryNonProportional">choose picture</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">pic1</span> → <span class="EmphasisFontCategoryNonProportional">post to wall</span>
            </div><div class="Para">An alternative way to display a picture is to set the wall’s background image, as follows.</div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
              <span class="EmphasisFontCategoryNonProportional">pic1 := media</span> → <span class="EmphasisFontCategoryNonProportional">choose picture</span>
            </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">wall</span> → <span class="EmphasisFontCategoryNonProportional">set background picture(pic1)</span>
            </div><div class="Para">The general-purpose methods of the <span class="EmphasisFontCategoryNonProportional">Picture</span> type are listed in Table <span class="InternalRef"><a href="#Tab4">6-4</a></span>.
<div id="Tab4" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 6-4</span><div class="SimplePara">General Picture methods</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Methods of Picture Datatype</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">at(index: Number): Color</div></td><td align="left"><div class="SimplePara">Returns the color of the pixel at the given index in the picture</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">clone : Picture</div></td><td align="left"><div class="SimplePara">Returns a copy of the Picture</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">count : Number</div></td><td align="left"><div class="SimplePara">Returns number of pixels</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">crop(left : Number, top : Number, width : Number, height : Number)</div></td><td align="left"><div class="SimplePara">Crops the picture to a rectangular portion of the original.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">date : DateTime</div></td><td align="left"><div class="SimplePara">Returns a date associated with the picture (if there is one)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">flip horizontal</div></td><td align="left"><div class="SimplePara">flips the picture left to right</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">flip vertical</div></td><td align="left"><div class="SimplePara">flips the picture top to bottom</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">height : Number</div></td><td align="left"><div class="SimplePara">Returns height of picture in pixels</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">is panorama : Boolean</div></td><td align="left"><div class="SimplePara">Returns true if width &gt; height</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">location : Location</div></td><td align="left"><div class="SimplePara">Returns a location associated with the picture (if there is one)</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">pixel(left : Number, top : Number) : Color</div></td><td align="left"><div class="SimplePara">Gets the pixel color at the specified x,y position</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">post to wall</div></td><td align="left"><div class="SimplePara">Displays the picture</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">resize(width : Number, height : Number)</div></td><td align="left"><div class="SimplePara">Scales the picture to have a new width and height</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">save to library : String</div></td><td align="left"><div class="SimplePara">Stores the picture in the Saved Pictures album and returns the filename</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">set pixel(left : Number, top : Number, color : Color)</div></td><td align="left"><div class="SimplePara">Sets the pixel color at the specified x,y position</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">update on wall</div></td><td align="left"><div class="SimplePara">If this picture has been displayed and then changed, this method replaces the displayed image with the new one</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">width : Number</div></td><td align="left"><div class="SimplePara">Returns width of picture in pixels</div></td></tr></tbody></table></div>
            </div><div class="Para">The table omits methods which change the colors or the brightness, or methods which overlay shapes etc. on top of the picture. All such methods are covered in the following subsections of this chapter.</div><div id="Sec7" class="Section3 RenderAsSection3"><h4 class="Heading">Care in Using the at, pixel and set pixel methods</h4><div class="Para">Table <span class="InternalRef"><a href="#Tab4">6-4</a></span> includes the <span class="EmphasisFontCategoryNonProportional">at</span>, <span class="EmphasisFontCategoryNonProportional">pixel</span> and <span class="EmphasisFontCategoryNonProportional">set pixel</span> methods. Before any of these methods is used in a script, some thought should be given to how large the picture is.</div><div class="Para">Any TouchDevelop script which accesses every pixel of a picture can be exceedingly slow to run, as well as draining the battery of a portable device. The implication is that the Picture type’s <span class="EmphasisFontCategoryNonProportional">at</span>, <span class="EmphasisFontCategoryNonProportional">pixel</span> and <span class="EmphasisFontCategoryNonProportional">set pixel</span> methods should be used only on pictures containing a modest number of pixels. Pictures taken by the camera contain as many pixels as the camera’s resolution. For example, it is not uncommon for phone cameras to have 6 megapixel resolution or higher. Pictures downloaded from the internet or transferred from your computer may contain even more pixels.</div><div class="Para">Although a picture shown on the screen is scaled to fit within the screen’s size, the picture retains its original number of pixels in the device’s memory. Unless the picture is intended to be copied to another device, it would usually be appropriate to reduce the picture’s resolution to match the screen resolution. Note that any method which processes all the pixels in a single call, such as <span class="EmphasisFontCategoryNonProportional">resize</span>, is reasonably fast.</div><div class="Para">The <span class="EmphasisFontCategoryNonProportional">at</span> method is useful for determining various aggregate properties of a picture, such as its average brightness. In more sophisticated scripts, the <span class="EmphasisFontCategoryNonProportional">pixel</span> method could for example be used for analyzing a picture and extracting details such as edges or, when <span class="EmphasisFontCategoryNonProportional">set pixel</span> is used too, for sharpening edges.</div><div class="Para">An example script which computes a picture’s average brightness is shown in Figure <span class="InternalRef"><a href="#Fig2">6-2</a></span>. Each pixel in the picture has a color value composed from red (R), green (G) and blue (B) components whose values range from zero intensity or 0.0 up to the maximum intensity which is 1.0. From the R,G,B values of a pixel, its luminosity can be calculated. (See, for example, the explanation of the YUV color space and the conversion formula for computing YUV values in Wikipedia.) The luminosity is a measure of the brightness of that pixel.
<div class="Figure" id="Fig2"><div class="MediaObject" id="MO2"><img src="A978-1-4302-6137-7_6_Fig2_HTML.jpg" alt="A978-1-4302-6137-7_6_Fig2_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 6-2</span><div class="SimplePara">Computing brightness</div></div></div></div>
              </div><div class="Para">The <span class="EmphasisFontCategoryNonProportional">at</span> and <span class="EmphasisFontCategoryNonProportional">pixel</span> methods are similar because they both retrieve the color of a particular pixel. Generally speaking, the <span class="EmphasisFontCategoryNonProportional">at</span> method should be used when it does not matter where the pixel is located within the picture, as is the case for the brightness calculation in Figure <span class="InternalRef"><a href="#Fig2">6-2</a></span>. It provides more efficient access because only one for loop to access all the pixels is needed. The <span class="EmphasisFontCategoryNonProportional">pixel</span> and <span class="EmphasisFontCategoryNonProportional">set pixel</span> methods would normally be placed inside two nested for loops, one to run through the rows and the other through the columns. The equivalence between the two ways to access a particular pixel is as follows.</div><div class="Para ParaTypeProgramcode">                       <span class="EmphasisFontCategoryNonProportional">pic1</span> → <span class="EmphasisFontCategoryNonProportional">pixel(x,y)    ≡   pic1</span> → <span class="EmphasisFontCategoryNonProportional">at( y*pic1</span> → <span class="EmphasisFontCategoryNonProportional">width + x )</span>
              </div><div class="Para">Note that y coordinate values are measured from the top edge of the picture down. It is the opposite convention to that used in geometry.</div></div><div id="Sec8" class="Section3 RenderAsSection3"><h4 class="Heading">Picture colorizing effects</h4><div class="Para">The colors, the contrast and the brightness of a picture can all be modified using more methods of the <span class="EmphasisFontCategoryNonProportional">Picture</span> type which are listed in Table <span class="InternalRef"><a href="#Tab5">6-5</a></span>.</div><div class="Para">The <span class="EmphasisFontCategoryNonProportional">brightness</span> method can be used to increase or decrease the luminosities of all the pixels in the image in unison, so that the picture appears brighter or darker. The <span class="EmphasisFontCategoryNonProportional">contrast</span> method can be used to increase or decrease the range of luminosities, so that there is greater or smaller contrast between light and dark regions.</div><div class="Para">The <span class="EmphasisFontCategoryNonProportional">colorize</span> method is intended for creating a two color image from a greyscale image. All pixels darker than a specified threshold value (a number in the range 0.0 to 1.0) are replaced by the background color, while all those brighter are replaced by the foreground color. The method can also be applied to color images, but that image is converted to grayscale before the colorization is applied.
<div id="Tab5" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 6-5</span><div class="SimplePara">Colorizing/intensity picture effects</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Methods of Picture</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">brightness(factor : Number) : Nothing</span>
                          </div></td><td align="left"><div class="SimplePara">Increases of decreases the brightness of the picture. The parameter ranges from -1 to +1.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">colorize(background : Color, foreground : Color, threshold : Number) : Nothing</span>
                          </div></td><td align="left"><div class="SimplePara">Changes the picture to a two color scheme. Pixels darker than threshold become the background color, those brighter become the foreground color.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">contrast(factor : Number) : Nothing</span>
                          </div></td><td align="left"><div class="SimplePara">Increases or decreases contrast level of the picture. The parameter ranges from -1 to +1.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">desaturate : Nothing</span>
                          </div></td><td align="left"><div class="SimplePara">Converts the picture to grayscale.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">invert : Nothing</span>
                          </div></td><td align="left"><div class="SimplePara">Inverts the intensity of each of the R, G, B color components</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">
                            <span class="EmphasisFontCategoryNonProportional">tint(color : Color) : Nothing</span>
                          </div></td><td align="left"><div class="SimplePara">Converts the picture to grayscale, and then tints with the supplied color</div></td></tr></tbody></table></div>
              </div><div class="Para">The final picture will no longer have any variations in intensity. All pixels of the foreground color have the same intensity, as do all those with the background color.</div><div class="Para">The <span class="EmphasisFontCategoryNonProportional">invert</span> method produces a result similar to a color negative, as would be observed with a 35mm camera using chemically developed color film. (This is a type of camera which is becoming rare.)</div></div><div id="Sec9" class="Section3 RenderAsSection3"><h4 class="Heading">Picture overlaying</h4><div class="Para">The next section in this chapter, section 6.3, is all about drawing text, lines and various shapes on top of a picture. What about superimposing another picture on top of a picture? That facility is provided by the <span class="EmphasisFontCategoryNonProportional">blend</span> method. It is called <span class="EmphasisTypeItalic">blend</span> as opposed to ‘superimpose’ say, because one of the method’s parameters chooses the opacity of the overlaid image. By choosing a low degree of opacity, the image at the bottom can be seen through the image on the top – achieving a blending of the two images.</div><div class="Para">The following few lines of code illustrate the concept.</div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
                <span class="EmphasisFontCategoryNonProportional">pic1 := media</span> → <span class="EmphasisFontCategoryNonProportional">choose picture</span>
              </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
                <span class="EmphasisFontCategoryNonProportional">w := pic1</span> → <span class="EmphasisFontCategoryNonProportional">width</span>
              </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
                <span class="EmphasisFontCategoryNonProportional">h := pic1</span> → <span class="EmphasisFontCategoryNonProportional">height</span>
              </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
                <span class="EmphasisFontCategoryNonProportional">pic2 := media</span> → <span class="EmphasisFontCategoryNonProportional">choose picture</span>
              </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">pic2</span> → <span class="EmphasisFontCategoryNonProportional">resize( w*0.5, h*0.5 )</span>
              </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">pic1</span> → <span class="EmphasisFontCategoryNonProportional">blend( pic2, w*0.3, h*0.2, 30, 0.7 )</span>
              </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">pic1</span> → <span class="EmphasisFontCategoryNonProportional">post to wall</span>
              </div><div class="Para">The relationship of the two pictures to each other is illustrated in Figure <span class="InternalRef"><a href="#Fig3">6-3</a></span>.
<div class="Figure" id="Fig3"><div class="MediaObject" id="MO3"><img src="A978-1-4302-6137-7_6_Fig3_HTML.jpg" alt="A978-1-4302-6137-7_6_Fig3_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 6-3</span><div class="SimplePara">Blending two pictures</div></div></div></div>
              </div><div class="Para">The top left corner of <span class="EmphasisFontCategoryNonProportional">pic2</span> is located at the x,y coordinates given by the second and third arguments to <span class="EmphasisFontCategoryNonProportional">blend</span>. This picture is rotated clockwise by the number of degrees given by the fourth argument. The opacity of the picture has been set at 0.7, which means that in the overlaid region, each pixel is a blend of 70% from <span class="EmphasisFontCategoryNonProportional">pic2</span> and 30% from <span class="EmphasisFontCategoryNonProportional">pic1</span>. Finally, the bottom right of <span class="EmphasisFontCategoryNonProportional">pic2</span> has been clipped to fit within <span class="EmphasisFontCategoryNonProportional">pic1</span>.</div></div></div></div><div id="Sec10" class="Section1 RenderAsSection1"><h2 class="Heading">6.3 Static graphics drawing and display</h2><div class="Para">A picture can be a photograph, a drawing, or a combination of the two. The methods provided by the <span class="EmphasisFontCategoryNonProportional">Picture</span> datatype for drawing lines and shapes are listed in Table <span class="InternalRef"><a href="#Tab6">6-6</a></span>.
<div id="Tab6" class="Table"><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 6-6</span><div class="SimplePara">Drawing methods of the Picture datatype</div></div></div><table border="1"><colgroup><col align="left"/><col align="left"/></colgroup><thead><tr class="header"><th align="left"><div class="SimplePara">Methods of Picture</div></th><th align="left"><div class="SimplePara">Description</div></th></tr></thead><tbody><tr class="noclass"><td align="left"><div class="SimplePara">clear(color : Color)</div></td><td align="left"><div class="SimplePara">Sets all pixels to the given color</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">draw ellipse(left: Number,</div><div class="SimplePara">top: Number, width: Number, height : Number, angle : Number, c: Color, thickness: Number)</div></td><td align="left"><div class="SimplePara">Draws an ellipse; its bounding rectangle has the given width and height and is located at the specified position; its orientation is rotated clockwise by the angle given; the line has the color and thickness specified.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">draw line(x1: Number,</div><div class="SimplePara">y1: Number, x2: Number,</div><div class="SimplePara">y2: Number, color: Color, thickness : Number)</div></td><td align="left"><div class="SimplePara">Draws a line from x1,y1 to x2,y2; the line has the color and thickness specified.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">draw rect(left : Number,</div><div class="SimplePara">top : Number, width : Number, height : Number, angle : Number, c : Color, thickness : Number)</div></td><td align="left"><div class="SimplePara">Draws a rectangle which has the width and height provided and is located at the specified position; its orientation is rotated clockwise by the angle given; the line has the color and thickness specified.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">draw text(left : Number,</div><div class="SimplePara">top : Number, text : String,</div><div class="SimplePara">font size : Number,</div><div class="SimplePara">angle : Number, color : Color)</div></td><td align="left"><div class="SimplePara">Writes text at the position specified, at the given font size and in the specified color; the text is rotated clockwise by the angle given</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">fill ellipse(left : Number,</div><div class="SimplePara">top : Number, width : Number, height : Number, angle : Number, color : Color)</div></td><td align="left"><div class="SimplePara">Like draw ellipse except that it is a solid (filled) ellipse.</div></td></tr><tr class="noclass"><td align="left"><div class="SimplePara">fill rect(left : Number,</div><div class="SimplePara">top : Number, width : Number, height : Number, angle : Number, color : Color)</div></td><td align="left"><div class="SimplePara">Like draw rect except that it is a solid (filled) rectangle.</div></td></tr></tbody></table></div>
          </div><div class="Para">In addition to these, there is the <span class="EmphasisFontCategoryNonProportional">set pixel</span> method which has already been covered and also the <span class="EmphasisFontCategoryNonProportional">create picture</span> method of the <span class="EmphasisFontCategoryNonProportional">media</span> resource for creating a new empty picture as illustrated below. All pixels in the new picture are colored white.</div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">// create picture 400 pixels wide, 200 pixels high</span>
          </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
            <span class="EmphasisFontCategoryNonProportional">pic := media</span> → <span class="EmphasisFontCategoryNonProportional">create picture( 400, 200 )</span>
          </div><div class="Para">Figure <span class="InternalRef"><a href="#Fig4">6-4</a></span> shows how the parameters of the <span class="EmphasisFontCategoryNonProportional">draw ellipse</span> method control the placement and orientation of the ellipse within a picture. An ellipse fits within a bounding rectangle, as drawn, and it is the width and height of that rectangle which are specified as arguments of the method.
<div class="Figure" id="Fig4"><div class="MediaObject" id="MO4"><img src="A978-1-4302-6137-7_6_Fig4_HTML.jpg" alt="A978-1-4302-6137-7_6_Fig4_HTML.jpg"/></div><div class="Caption" xml:lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 6-4</span><div class="SimplePara">Using the draw ellipse method</div></div></div></div>
          </div><div class="Para">The left and top parameters provide the x, y coordinates of the top left corner of that bounding rectangle. Note that y coordinate values are measured downwards from the top of the picture.</div><div class="Para">A circle is a special case of an ellipse. Most graphics drawing software would draw a circle of a given radius and with its center at a specified position. To use the <span class="EmphasisFontCategoryNonProportional">draw ellipse</span> method, some extra arithmetic is needed. An action which accepts radius and the position of the center would be programmed as follows.</div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">// Draws a circle with radius r and center at x, y.</span>
          </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">action</span></span>
            <span class="EmphasisFontCategoryNonProportional">Draw Circle( pic: Picture, r: Number, x: Number, y: Number,</span>
          </div><div class="Para ParaTypeProgramcode">                    <span class="EmphasisFontCategoryNonProportional">thickness: Number, color: Color )</span>
          </div><div class="Para ParaTypeProgramcode">                  <span class="EmphasisFontCategoryNonProportional">pic</span> → <span class="EmphasisFontCategoryNonProportional">draw ellipse( x-r, y-r, r*2, r*2, 0, color, thickness )</span>
          </div><div class="Para">Drawing rectangles and filled versions of ellipses and rectangles is handled similarly; further explanation should not be needed.</div></div><div id="Sec11" class="Section1 RenderAsSection1"><h2 class="Heading">6.4 Playing videos from the internet</h2><div class="Para">Video files tend to be very large. You should think before storing one on a device with limited memory, such as a phone. Videos held on the phone can be created by using the phone’s camera or by being copied from a PC when the phone is synchronized.</div><div class="Para">TouchDevelop does not provide access to video files held on a smartphone. Nor can a script download a video file to the phone. However a script can access and play videos which are streamed from the internet.</div><div class="Para">Given the URL of a video file which is in a format that the device can play, a TouchDevelop script can open and play that file. The supported video formats can depend on the particular model of device in use. However most video files with the filename suffix <span class="EmphasisFontCategoryNonProportional">‘.mp4’</span> should work. (An H.264 encoded MP4 file is the format which works on every Windows phone, for example.)</div><div class="Para">Given the URL, a direct way to play the video is as follows.</div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">// url is a String variable holding the URL of the file</span>
          </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">web</span> → <span class="EmphasisFontCategoryNonProportional">play media( url )</span>
          </div><div class="Para">It displays the video using the entire window. The back button can be used to stop the video.</div><div class="Para">An alternative means of playing the video is to create a <span class="EmphasisFontCategoryNonProportional">Link</span> value. Some sample code is as follows.</div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">// url is a String variable holding the URL of the file</span>
          </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">var</span></span>
            <span class="EmphasisFontCategoryNonProportional">lnk := web</span> → <span class="EmphasisFontCategoryNonProportional">link media( url )</span>
          </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisFontCategoryNonProportional">…</span>
          </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">if not</span></span>
            <span class="EmphasisFontCategoryNonProportional">lnk</span> → <span class="EmphasisFontCategoryNonProportional">is invalid</span>
            <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">then</span></span>
          </div><div class="Para ParaTypeProgramcode">                              <span class="EmphasisFontCategoryNonProportional">lnk</span> → <span class="EmphasisFontCategoryNonProportional">post to wall</span>
          </div><div class="Para ParaTypeProgramcode">                              <span class="EmphasisFontCategoryNonProportional">“Tap video link to play it”</span> → <span class="EmphasisFontCategoryNonProportional">post to wall</span>
          </div><div class="Para ParaTypeProgramcode">               <span class="EmphasisTypeBold"><span class="EmphasisFontCategoryNonProportional">else</span></span>
          </div><div class="Para ParaTypeProgramcode">                              <span class="EmphasisFontCategoryNonProportional">(“Could not access url “ || url)</span> → <span class="EmphasisFontCategoryNonProportional">post to wall</span>
          </div><div class="Para">The second approach shown above allows a script to show a list of links on the screen, allowing the user to select which one to play.</div></div></div></body></html>
